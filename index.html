<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Liaoxb&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Liaoxb&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Liaoxb&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Liaoxb's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Liaoxb's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/29/mysql_query/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/29/mysql_query/" itemprop="url">Mysql常用查询</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-29T18:02:56+08:00">
                2020-07-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="创建数据库和表"><a href="#创建数据库和表" class="headerlink" title="创建数据库和表"></a>创建数据库和表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库</span><br><span class="line">mysql&gt; create database SRS default charset utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; use SRS;</span><br><span class="line"></span><br><span class="line"># 创建学生表,字段有姓名、性别、出生日期、家庭地址、照片</span><br><span class="line">mysql&gt; create table student ( id integer not null, name varchar(20) not null, sex bit default 1, birth datetime not null, tel char(11), addr varchar(255), photo longblob, primary key (id) );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"># 删除tel列</span><br><span class="line">mysql&gt; alter table student drop column tel;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe student;</span><br><span class="line">+-------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type         | Null | Key | Default | Extra |</span><br><span class="line">+-------+--------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11)      | NO   | PRI | NULL    |       |</span><br><span class="line">| name  | varchar(20)  | NO   |     | NULL    |       |</span><br><span class="line">| sex   | bit(1)       | YES  |     | b&apos;1&apos;    |       |</span><br><span class="line">| birth | datetime     | NO   |     | NULL    |       |</span><br><span class="line">| addr  | varchar(255) | YES  |     | NULL    |       |</span><br><span class="line">| photo | longblob     | YES  |     | NULL    |       |</span><br><span class="line">+-------+--------------+------+-----+---------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 创建课程表，字段有课程名、课程介绍</span><br><span class="line">mysql&gt; create table course ( id integer not null, name varchar(50) not null, credit tinyint not null, intro varchar(255) );</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"># 给课程表指定主键</span><br><span class="line">mysql&gt; alter table course add constraint pk_course primary key (id);</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; describe course;</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">| id     | int(11)      | NO   | PRI | NULL    |       |</span><br><span class="line">| name   | varchar(50)  | NO   |     | NULL    |       |</span><br><span class="line">| credit | tinyint(4)   | NO   |     | NULL    |       |</span><br><span class="line">| intro  | varchar(255) | YES  |     | NULL    |       |</span><br><span class="line">+--------+--------------+------+-----+---------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 创建学生选课记录表</span><br><span class="line">mysql&gt; create table sc</span><br><span class="line">    -&gt; (</span><br><span class="line">    -&gt; scid integer primary key auto_increment,</span><br><span class="line">    -&gt; sid integer not null,</span><br><span class="line">    -&gt; cid integer,</span><br><span class="line">    -&gt; scdate datetime not null,</span><br><span class="line">    -&gt; score float</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; describe sc;</span><br><span class="line">+--------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+--------+----------+------+-----+---------+----------------+</span><br><span class="line">| scid   | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| sid    | int(11)  | NO   |     | NULL    |                |</span><br><span class="line">| cid    | int(11)  | YES  |     | NULL    |                |</span><br><span class="line">| scdate | datetime | NO   |     | NULL    |                |</span><br><span class="line">| score  | float    | YES  |     | NULL    |                |</span><br><span class="line">+--------+----------+------+-----+---------+----------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 添加外键</span><br><span class="line">mysql&gt; alter table sc add foreign key (sid) references student (id) on delete cascade on update cascade;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table sc add foreign key (cid) references course (id) on delete set null on update cascade;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<h2 id="构造数据"><a href="#构造数据" class="headerlink" title="构造数据"></a>构造数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 学生表单条插入数据</span><br><span class="line">mysql&gt; insert into student values (1001, &apos;张三丰&apos;, default, &apos;1978-1-1&apos;, &apos;成都市一环路西二段17号&apos;, null);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into student (id, name, birth) values (1002, &apos;郭靖&apos;, &apos;1980-2-2&apos;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into student (id, name, sex, birth, addr) values (1003, &apos;黄蓉&apos;, 0, &apos;1982-3-3&apos;, &apos;成都市二环路南四段123号&apos;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into student values (1004, &apos;张无忌&apos;, 1, &apos;1990-4-4&apos;, null, null);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into student values (1005, &apos;丘处机&apos;, 1, &apos;1983-5-5&apos;, &apos;北京市海淀区宝盛北里西区28号&apos;, null);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 课程表批量插入数据</span><br><span class="line">mysql&gt; insert into course values (1111, &apos;C语言程序设计&apos;, 3, &apos;大神级讲师授课需要抢座&apos;),</span><br><span class="line">    -&gt; (2222, &apos;Java程序设计&apos;, 3, null),</span><br><span class="line">    -&gt; (3333, &apos;数据库概论&apos;, 2, null),</span><br><span class="line">    -&gt; (4444, &apos;操作系统原理&apos;, 4, null);</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"># 选课记录表批量插入数据</span><br></pre></td></tr></table></figure>
<h2 id="查询练习"><a href="#查询练习" class="headerlink" title="查询练习"></a>查询练习</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from student;</span><br><span class="line">+------+-----------+------+---------------------+-------------------------------------------+-------+</span><br><span class="line">| id   | name      | sex  | birth               | addr                                      | photo |</span><br><span class="line">+------+-----------+------+---------------------+-------------------------------------------+-------+</span><br><span class="line">| 1001 | 张三丰    |     | 1978-01-01 00:00:00 | 成都市一环路西二段17号                    | NULL  |</span><br><span class="line">| 1002 | 郭靖      |     | 1980-02-02 00:00:00 | NULL                                      | NULL  |</span><br><span class="line">| 1003 | 黄蓉      |      | 1982-03-03 00:00:00 | 成都市二环路南四段123号                   | NULL  |</span><br><span class="line">| 1004 | 张无忌    |     | 1990-04-04 00:00:00 | NULL                                      | NULL  |</span><br><span class="line">| 1005 | 丘处机    |     | 1983-05-05 00:00:00 | 北京市海淀区宝盛北里西区28号              | NULL  |</span><br><span class="line">+------+-----------+------+---------------------+-------------------------------------------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from sc;</span><br><span class="line">+------+------+------+---------------------+-------+</span><br><span class="line">| scid | sid  | cid  | scdate              | score |</span><br><span class="line">+------+------+------+---------------------+-------+</span><br><span class="line">|    1 | 1001 | 1111 | 2016-09-01 00:00:00 |    95 |</span><br><span class="line">|    2 | 1002 | 1111 | 2016-09-01 00:00:00 |    94 |</span><br><span class="line">|    3 | 1001 | 2222 | 2020-07-26 10:59:08 |    97 |</span><br><span class="line">|    4 | 1001 | 3333 | 2017-03-01 00:00:00 |    85 |</span><br><span class="line">|    5 | 1001 | 4444 | 2020-07-26 10:59:08 |    88 |</span><br><span class="line">|    6 | 1002 | 4444 | 2020-07-26 10:59:08 |    77 |</span><br><span class="line">|    7 | 1003 | 2222 | 2020-07-26 10:59:08 |    66 |</span><br><span class="line">|    8 | 1003 | 3333 | 2020-07-26 10:59:08 |    90 |</span><br><span class="line">|    9 | 1005 | 2222 | 2020-07-26 10:59:08 |    60 |</span><br><span class="line">+------+------+------+---------------------+-------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from course;</span><br><span class="line">+------+--------+--------+-----------------------------------+</span><br><span class="line">| id   | name   | credit | intro                             |</span><br><span class="line">+------+--------+--------+-----------------------------------+</span><br><span class="line">| 1111 | 语文   |      3 | 大神级讲师授课需要抢座            |</span><br><span class="line">| 2222 | 数学   |      3 | NULL                              |</span><br><span class="line">| 3333 | 外语   |      2 | NULL                              |</span><br><span class="line">| 4444 | 理综   |      4 | NULL                              |</span><br><span class="line">+------+--------+--------+-----------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有女学生的姓名和出生日期(筛选) </span><br><span class="line">select name,birth from student where sex=0;</span><br><span class="line"></span><br><span class="line"># 查询所有80后学生的姓名、性别和出生日期(筛选)</span><br><span class="line">select name,sex,birth from student where birth between &apos;1980-1-1&apos; and &apos;1989-12-31&apos;;</span><br><span class="line"></span><br><span class="line"># 查询姓郭名字总共两个字的学生的姓名(模糊)</span><br><span class="line">select name from student where name like &apos;郭_&apos; ;</span><br><span class="line"></span><br><span class="line"># 查询地址住在成都的学生姓名(模糊)</span><br><span class="line">select name,addr from student where addr like &apos;%成都%&apos;;</span><br><span class="line"></span><br><span class="line"># 查询没有录入家庭住址和照片的学生姓名(多条件筛选和空值处理)</span><br><span class="line">select name from student where addr is null and photo is null;</span><br><span class="line"></span><br><span class="line"># 查询数学成绩在90以下的学生学号(多条件筛选)</span><br><span class="line">select sid from sc where score&lt;90 and cid=2222;</span><br><span class="line"></span><br><span class="line"># 查询填写了地址信息的学生数量</span><br><span class="line">select count(addr) from student;</span><br><span class="line"></span><br><span class="line"># 查询学生的姓名和生日按年龄从大到小排列(排序)</span><br><span class="line">select name,birth from student order by birth;</span><br><span class="line"></span><br><span class="line"># 查询学生的姓名和生日按年龄从小到大排列(排序)</span><br><span class="line">select name,birth from student order by birth desc;</span><br><span class="line"></span><br><span class="line"># 查询学生选课的所有日期(去重)</span><br><span class="line">select distinct scdate from sc;</span><br><span class="line"></span><br><span class="line"># 查询学生id为1001的课程总成绩(筛选和聚合函数)</span><br><span class="line">select sum(score) from sc where sid=1001;</span><br><span class="line"></span><br><span class="line"># 查询学生id为1001的课程平均成绩(筛选和聚合函数)</span><br><span class="line">select avg(score) from sc where sid=1001;</span><br><span class="line"></span><br><span class="line"># 查询每个学生学号的平均成绩, (分组和聚合函数)</span><br><span class="line">select sid as &quot;学号&quot;, avg(score) as &quot;平均成绩&quot; from sc group by sid;</span><br><span class="line"></span><br><span class="line"># 查询平均成绩大于等于90分的学生的学号和平均成绩</span><br><span class="line"> select sid as &quot;学号&quot;, avg(score) as &quot;平均成绩&quot; from sc group by sid having avg(score)&gt;90;</span><br><span class="line"> </span><br><span class="line"># 查询年龄最大的学生的姓名(子查询)</span><br><span class="line">select name,birth from student where birth=(select min(birth) from student);</span><br><span class="line"></span><br><span class="line"># 查询选课学生的学号、姓名和平均成绩(左连接查询)</span><br><span class="line">select id,name,avg(score) from student left join sc on student.id=sc.sid group by id;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/23/selenium-grid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/23/selenium-grid/" itemprop="url">selenium-grid实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-23T21:02:56+08:00">
                2020-07-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、镜像分类</p>
<blockquote>
<p>hub 是集中管理节点，集中对外提供服务。node 是分布式的浏览器节点，受 hub 节点的控制。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用的镜像：</span><br><span class="line">selenium/hub:Selenium Grid Hub 节点</span><br><span class="line">selenium/node-chrome:安装有 Chrome 的 Selenium Node 节点镜像</span><br><span class="line">selenium/node-firefox:安装有 Firefox 的 Selenium Node 节点镜像</span><br><span class="line">selenium/node-chrome-debug: 安装有 Chrome 的 Selenium Node 节点镜像，包含远程桌面</span><br><span class="line">selenium/node-firefox-debug: 安装有 Firefox 的 Selenium Node 节点镜像，包含远程桌面</span><br></pre></td></tr></table></figure>
<p>2、使用场景</p>
<blockquote>
<p>解决重复执行测试,解决多浏览器兼容测试</p>
</blockquote>
<blockquote>
<p>分布式执行，减少测试运行时间</p>
</blockquote>
<p>3、安装部署</p>
<blockquote>
<p>docker方式安装</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker run -d -p 4444:4444 --name selenium-hub selenium/hub</span><br><span class="line"></span><br><span class="line">docker run -d --name node-chrome --link selenium-hub:hub selenium/node-chrome</span><br><span class="line"></span><br><span class="line">docker run -d --name node-firefox --link selenium-hub:hub selenium/node-firefox</span><br></pre></td></tr></table></figure>
<blockquote>
<p>docker-compose方式安装</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  selenium-hub:</span><br><span class="line">    image: selenium/hub</span><br><span class="line">    container_name: selenium-hub</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;4444:4444&quot;</span><br><span class="line"></span><br><span class="line">  chrome:</span><br><span class="line">    image: selenium/node-chrome</span><br><span class="line">    volumes:</span><br><span class="line">      - /dev/shm:/dev/shm</span><br><span class="line">    depends_on:</span><br><span class="line">      - selenium-hub</span><br><span class="line">    environment:</span><br><span class="line">      - HUB_HOST=selenium-hub</span><br><span class="line">    #ports:</span><br><span class="line">    #  - &quot;5900:5900&quot; # for VNC viewer</span><br><span class="line"></span><br><span class="line">  firefox:</span><br><span class="line">    image: selenium/node-firefox</span><br><span class="line">    volumes:</span><br><span class="line">      - /dev/shm:/dev/shm</span><br><span class="line">    depends_on:</span><br><span class="line">      - selenium-hub</span><br><span class="line">    environment:</span><br><span class="line">      - HUB_HOST=selenium-hub</span><br><span class="line"></span><br><span class="line"># 检查运行状态</span><br><span class="line">localhost% docker ps</span><br><span class="line">CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">6d4640a22a4f        selenium/node-firefox   &quot;/opt/bin/entry_poin…&quot;   15 minutes ago      Up 15 minutes                                 node-firefox</span><br><span class="line">ff2fe54541ea        selenium/node-chrome    &quot;/opt/bin/entry_poin…&quot;   16 minutes ago      Up 16 minutes                                 node-chrome</span><br><span class="line">18d02a1b37bd        selenium/hub            &quot;/opt/bin/entry_poin…&quot;   19 minutes ago      Up 19 minutes       0.0.0.0:4444-&gt;4444/tcp   selenium-hub</span><br></pre></td></tr></table></figure>
<p>4、运行测试脚本</p>
<blockquote>
<p>当部署带debug的浏览器镜像，通过主机ports暴露和vnc命令就可以打开浏览器进行调试<br>open vnc://:<a href="mailto:secret@192.168.1.100" target="_blank" rel="noopener">secret@192.168.1.100</a>:5900</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 脚本里通过browserName指定测试浏览器</span><br><span class="line"></span><br><span class="line">localhost% cat grid_demo.py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">driver = webdriver.Remote(</span><br><span class="line">command_executor=&apos;http://127.0.0.1:4444/wd/hub&apos;,</span><br><span class="line">desired_capabilities=&#123;&apos;browserName&apos;: &apos;chrome&apos;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">driver.get(&apos;https://www.baidu.com&apos;)</span><br><span class="line">print(&quot;get baidu&quot;)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;hello selenium&quot;)</span><br><span class="line">driver.find_element_by_id(&quot;su&quot;).click()</span><br><span class="line"></span><br><span class="line">sleep(1)</span><br><span class="line"></span><br><span class="line">driver.get_screenshot_as_file(&quot;./baidu_img.png&quot;)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br><span class="line">print(&quot;end...&quot;)</span><br><span class="line"></span><br><span class="line">localhost% python grid_demo.py</span><br><span class="line">get baidu</span><br><span class="line">end...</span><br></pre></td></tr></table></figure>
<p>5、查看hub容器运行日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">localhost% docker logs -f 18d02a1b37bd</span><br><span class="line">2020-07-22 10:14:33,369 INFO Included extra file &quot;/etc/supervisor/conf.d/selenium-hub.conf&quot; during parsing</span><br><span class="line">2020-07-22 10:14:33,371 INFO supervisord started with pid 8</span><br><span class="line">2020-07-22 10:14:34,379 INFO spawned: &apos;selenium-hub&apos; with pid 11</span><br><span class="line">Starting Selenium Hub with configuration:</span><br><span class="line">2020-07-22 10:14:34,394 INFO success: selenium-hub entered RUNNING state, process has stayed up for &gt; than 0 seconds (startsecs)</span><br><span class="line">&#123;</span><br><span class="line">  &quot;host&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">  &quot;port&quot;: 4444,</span><br><span class="line">  &quot;role&quot;: &quot;hub&quot;,</span><br><span class="line">  &quot;maxSession&quot;: 5,</span><br><span class="line">  &quot;newSessionWaitTimeout&quot;: -1,</span><br><span class="line">  &quot;capabilityMatcher&quot;: &quot;org.openqa.grid.internal.utils.DefaultCapabilityMatcher&quot;,</span><br><span class="line">  &quot;throwOnCapabilityNotPresent&quot;: true,</span><br><span class="line">  &quot;jettyMaxThreads&quot;: -1,</span><br><span class="line">  &quot;cleanUpCycle&quot;: 5000,</span><br><span class="line">  &quot;browserTimeout&quot;: 0,</span><br><span class="line">  &quot;timeout&quot;: 1800,</span><br><span class="line">  &quot;debug&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">10:14:34.882 INFO [GridLauncherV3.parse] - Selenium server version: 3.141.59, revision: e82be7d358</span><br><span class="line">10:14:35.082 INFO [GridLauncherV3.lambda$buildLaunchers$5] - Launching Selenium Grid hub on port 4444</span><br><span class="line">2020-07-22 10:14:35.587:INFO::main: Logging initialized @1187ms to org.seleniumhq.jetty9.util.log.StdErrLog</span><br><span class="line">10:14:35.905 INFO [Hub.start] - Selenium Grid hub is up and running</span><br><span class="line">10:14:35.907 INFO [Hub.start] - Nodes should register to http://172.17.0.2:4444/grid/register/</span><br><span class="line">10:14:35.907 INFO [Hub.start] - Clients should connect to http://172.17.0.2:4444/wd/hub</span><br><span class="line">10:15:53.376 INFO [DefaultGridRegistry.add] - Registered a node http://172.17.0.3:5555</span><br><span class="line">10:17:20.131 INFO [DefaultRemoteProxy.onEvent] - Marking the node http://172.17.0.3:5555 as down: cannot reach the node for 2 tries</span><br><span class="line">10:17:23.039 INFO [DefaultGridRegistry.add] - Registered a node http://172.17.0.3:5555</span><br><span class="line">10:17:23.046 WARN [DefaultGridRegistry.removeIfPresent] - Cleaning up stale test sessions on the unregistered node http://172.17.0.3:5555</span><br><span class="line">10:18:28.156 INFO [DefaultGridRegistry.add] - Registered a node http://172.17.0.4:5555</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10:35:10.016 INFO [RequestHandler.process] - Got a request to create a new session: Capabilities &#123;browserName: firefox&#125;</span><br><span class="line">10:35:10.024 INFO [TestSlot.getNewSession] - Trying to create a new session on test slot &#123;server:CONFIG_UUID=77d8f1a3-4df1-417a-b274-e8e30d1e4de1, seleniumProtocol=WebDriver, browserName=firefox, maxInstances=1, moz:firefoxOptions=&#123;log=&#123;level=info&#125;&#125;, platformName=LINUX, version=68.0.1, applicationName=, platform=LINUX&#125;</span><br><span class="line"></span><br><span class="line">10:36:01.160 INFO [RequestHandler.process] - Got a request to create a new session: Capabilities &#123;browserName: chrome&#125;</span><br><span class="line">10:36:01.165 INFO [TestSlot.getNewSession] - Trying to create a new session on test slot &#123;server:CONFIG_UUID=5f3ba141-2be6-438a-91a3-fc5b4f60224a, seleniumProtocol=WebDriver, browserName=chrome, maxInstances=1, platformName=LINUX, version=76.0.3809.87, applicationName=, platform=LINUX&#125;</span><br></pre></td></tr></table></figure></p>
<p>6、node浏览器参数解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">browserTimeout: 0</span><br><span class="line"></span><br><span class="line">debug: false</span><br><span class="line"></span><br><span class="line">jettyMaxThreads: -1</span><br><span class="line"></span><br><span class="line">host: 172.17.0.3</span><br><span class="line"></span><br><span class="line">port: 5555</span><br><span class="line"></span><br><span class="line">role: node      # 表示启动的是node节点</span><br><span class="line"></span><br><span class="line">timeout: 1800</span><br><span class="line"></span><br><span class="line">cleanUpCycle: 5000</span><br><span class="line"></span><br><span class="line">maxSession: 1       # node节点最大会话请求</span><br><span class="line"></span><br><span class="line">capabilities: Capabilities &#123;applicationName: , browserName: chrome, maxInstances: 1, platform: LINUX, platformName: LINUX, seleniumProtocol: WebDriver, server:CONFIG_UUID: 5f3ba141-2be6-438a-91a3-fc5..., version: 76.0.3809.87&#125;</span><br><span class="line"></span><br><span class="line">downPollingLimit: 2</span><br><span class="line"></span><br><span class="line">hub: http://172.17.0.2:4444/grid/register   # 表示hub机地址</span><br><span class="line"></span><br><span class="line">id: http://172.17.0.3:5555</span><br><span class="line"></span><br><span class="line">nodePolling: 5000</span><br><span class="line"></span><br><span class="line">nodeStatusCheckTimeout: 5000</span><br><span class="line"></span><br><span class="line">proxy: org.openqa.grid.selenium.proxy.DefaultRemoteProxy</span><br><span class="line"></span><br><span class="line">register: true</span><br><span class="line"></span><br><span class="line">registerCycle: 5000</span><br><span class="line"></span><br><span class="line">remoteHost: http://172.17.0.3:5555</span><br><span class="line"></span><br><span class="line">unregisterIfStillDownAfter: 60000</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/PaaS_Design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/PaaS_Design/" itemprop="url">PaaS平台架构设计浅析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-20T21:13:44+08:00">
                2020-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="为什么需要PasS平台"><a href="#为什么需要PasS平台" class="headerlink" title="为什么需要PasS平台"></a>为什么需要PasS平台</h1><p>PaaS（平台即服务）给用户提供的平台化能力是建立在IaaS服务上层，它给用户提供的核心价值就围绕在Application和Data两方面。PaaS用户（一般指开发人员）只需专注于业务逻辑和应用本身研发，无需管理底层的基础设施，包括网络、服务器，操作系统或者存储，同时大大简化了研发运维间的沟通协作难度。<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/paas/paas1.png?raw=true" alt="示例1.png"></p>
<h1 id="如何建设PaaS平台"><a href="#如何建设PaaS平台" class="headerlink" title="如何建设PaaS平台"></a>如何建设PaaS平台</h1><h2 id="应用管理"><a href="#应用管理" class="headerlink" title="应用管理"></a>应用管理</h2><p>PaaS平台最核心的功能就是应用全生命周期管理。应用通常是一个独立完整的业务功能，一个应用可能由多个服务组件组成，对于微服务而言每个组件都可以独立于其他组件部署、启动、运行和治理。PaaS平台需要提高对应用的一键式部署、健康检查、弹性扩缩、升级发布、资源管理、访问管理、监控管理等功能，从而保证应用的整体服务能力。</p>
<p>一键式部署：一般支持通过镜像、应用模板和 YAML等方式部署应用，让用户可通过多种应用交付物快速便捷的部署。</p>
<p>健康检查：由于容器启动后应用还需要较长时间才能接受请求，容器正常运行但容器中的应用服务异常等原因。需要支持应用健康状态的检查，健康检查结果会指导负载均衡、滚动发布和弹性伸缩，实现更平滑的过程 。</p>
<p>弹性扩缩：支持通过手动、自动和定时等方式对容器的实例进行弹性的扩缩，保证应用运行的稳定性。</p>
<p>升级发布：支持通过单一服务按照指定实例数滚动升级实现滚动发布；通过建立跨服务的 4 层负载均衡实现灰度发布／蓝绿发布；并支持一键回滚；基于预定义镜像规则自动发布，支持 DevOps 自动化流水线场景。</p>
<p>资源管理：对容器部署或运行过程中的的 CPU、内存等计算资源、网络和存储资源的分配进行集中管理。</p>
<p>访问管理：容器的外部接入访问入口，和平台内部访问容器的控制台入口的管理。</p>
<p>监控管理：对容器产生的日志进行统一查看和导出，并且配置容器的日志管理服务器；对容器的资源包括CPU、内存、网络、存储等的使用情况进行可视化监控。</p>
<p>服务治理</p>
<p>服务治理通过提供完整的非侵入式的微服务治理解决方案，支持完整的服务生命周期管理和流量治理。能够很好的解决云原生服务的管理、网络连接以及安全管理等服务网络治理问题。</p>
<p>灰度发布：灰度发布是迭代软件产品在生产环境安全上线的重要手段。允许用户按照标准制定一套流量分发规则，平滑稳定的实现灰度发布功能。主要有金丝雀、蓝绿、A/B Testing 等典型灰度发布功能。</p>
<p>流量治理：应用流量治理提供可视化云原生应用的网络状态监控，并实现在线的网络连接和安全策略的管理配置。提供策略化、场景化的网络连接、安全策略管理能力。支持基于应用拓扑对服务配置负载均衡、熔断容错等治理规则，并提供实时的、可视化的服务流量管理。</p>
<p>流量监控：通过流量监控可以监控流量概况、组件运行状态、调用链等信息，并在系统业务异常时快速定位到问题点。</p>
<h2 id="Devops"><a href="#Devops" class="headerlink" title="Devops"></a>Devops</h2><p>由于软件开发复杂度的增高和更多的协同工作，敏捷开发能够更好地在协同工作中确保软件开发和交付质量。而 CI/CD 就是专门为解决上述需求的软件开发实践。CI/CD 要求每次的集成都是通过自动化的构建来验证，包括自动编译、发布和测试，从而尽快地发现集成错误，让团队能够更快的开发内聚的软件，减轻了软件发布时的压力。</p>
<p>持续集成：持续集成是一种实现产品和应用快速迭代的一种实践方式，这种实践要求开发人员所提交的每一次代码都能够快速被合并到生产线，并进行自动构建和上线。能够容易定位 Bug 并提前发现和解决，降低开发成本。</p>
<p>持续交付：持续交付的缩短了需求完成周期，满足小粒度交付需求，打造自持敏捷开发，精益迭代和持续交付的研发基础设施。此外，提高了产品迭代速度，提升了应用软件质量。并且支持容器扩容、收缩、升级和回滚，轻松实现应用灰度发布，还拥有更快的应用交付和Go-to-Market能力。</p>
<p>流水线：应用从代码编译、测试、打包和部署的过程，流水线管理一般使用常用的 Jenkinsfile 来表述一组 CI/CD 流程。从代码仓库 、代码编译、镜像制作、镜像安全、推送到仓库、应用版本、到定时构建的端到端流水线设置。</p>
<p>版本发布：DevOps 的应用版本管理可备份每个应用的关键配置。应用下可以设置应用版本，用于记录本次应用和其下制品版本的关系，可便于部署或回滚操作。</p>
<h2 id="运维管理"><a href="#运维管理" class="headerlink" title="运维管理"></a>运维管理</h2><p>日志、监控和告警等实现对容器云平台的组件状态、基础设施资源、运行的各个应用系统统一管理。让用户能够对平台进行手动和自动检查、排错和维护，保证平台的稳定。</p>
<p>日志：日志模块需收集平台组件、业务应用、业务服务以及云上中间件的日志。可采用平台统一日志管理系统，或对接 ELK。</p>
<p>监控告警：监控模块需提供对集群和应用的资源状态两个维度监控。并支持大规模系统监控、多指标监控、多维度监控，为每一个层级资源的运行状态都提供实时的多种指标监控。并且收集资源实时监控数据和历史监控数据，帮助用户观察和建立资源和集群性能的正常标准。监控模块可采用平台的自有监控体系，或对接外部监控系统，比如 Prometheus。</p>
<h2 id="交付中心"><a href="#交付中心" class="headerlink" title="交付中心"></a>交付中心</h2><p>容器镜像实现容器运行时标准化，应用模板（helm）实现编排文件的标准化。镜像和应用模板是开发（Dev）和运维（Ops）的媒介，完成测试的镜像、应用模板可以发布到生产环境；然后在平台上部署和管理应用，持续监控应用服务的运行情况，并保持持续的反馈运行情况，以便及时的改进，形成一个良性循环。</p>
<p>镜像管理：提供了多种构建镜像的方式，支持对接 CI/CD工具，能够简化企业应用容器化的难度，轻松实现应用的容器化。并提供日常镜像维护的功能，比如镜像扫描、镜像同步和镜像清理等。</p>
<p>应用模板：基于 Helm 标准的应用模板提供统一的资源管理与调度，高效地实现了模板的快速部署与后期管理，大幅简化了Kubernetes资源的安装管理过程。</p>
<h2 id="安全管理"><a href="#安全管理" class="headerlink" title="安全管理"></a>安全管理</h2><p>多租户管理：不同租户中的资源彼此隔离。使得它们既可以共享同一个平台资源，也能够互不干扰。对于平台来说，需要将平台的计算资源、存储资源和网络资源，分配给各租户，让租户根据自身使用场景管理应用、用户、角色和资源。</p>
<p>用户管理：用户管理模块，可对企业用户进行增删改查等操作，以及配置用户密码安全策略，保证用户和平台安全；同时可对接企业用户目录，同步企业现存用户管理系统，避免重复操作。</p>
<p>权限管理：权限管理是在 Kubernetes的角色访问控制（RBAC）的能力基础上，打造的细粒度权限管理功能。支持集群级别、租户级别的权限控制，能够从集群和租户层面对用户组或用户进行细粒度授权。</p>
<p>第三方登录认证：当对接企业现有用户中心时，需要实现第三方登录认证。用户只需要登录一次，就可以访问所有相互信任的应用系统。解决企业不同业务应用之间的身份认证问题。<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/paas/paas3.png?raw=true" alt="示例1.png"></p>
<p>文档参考链接来源：<br><a href="https://www.kubernetes.org.cn/7272.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/7272.html</a><br><a href="https://zhuanlan.zhihu.com/p/108719565" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/108719565</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/30/git-worknote/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/30/git-worknote/" itemprop="url">git工作笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-30T21:02:56+08:00">
                2019-12-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="场景一：基于master快速切一个新分支，bugfix后提交到远端"><a href="#场景一：基于master快速切一个新分支，bugfix后提交到远端" class="headerlink" title="场景一：基于master快速切一个新分支，bugfix后提交到远端"></a>场景一：基于master快速切一个新分支，bugfix后提交到远端</h4><blockquote>
<p>创建新分支(同时切换到bugfix1)<br>代码提交<br>代码push至新分支</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Already up to date.</span><br><span class="line">localhost:bookstore liaoxb$ git checkout -b bugfix1</span><br><span class="line">Switched to a new branch &apos;bugfix1&apos;</span><br><span class="line">localhost:bookstore liaoxb$ echo &apos;bugfix test&apos; &gt; test.txt</span><br><span class="line">localhost:bookstore liaoxb$ git add .</span><br><span class="line">localhost:bookstore liaoxb$ git commit -m &quot;bugfix test&quot;</span><br><span class="line">[bugfix1 2eafe98] bugfix test</span><br><span class="line"> 1 file changed, 1 insertion(+), 3 deletions(-)</span><br><span class="line">localhost:bookstore liaoxb$ git push --set-upstream origin bugfix1</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 259 bytes | 259.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 1), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">remote: Create a pull request for &apos;bugfix1&apos; on Gitee by visiting:</span><br><span class="line">remote:     https://gitee.com/wisecloud/bookstore/pull/new/wisecloud:bugfix1...wisecloud:master</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line"> * [new branch]      bugfix1 -&gt; bugfix1</span><br><span class="line">Branch &apos;bugfix1&apos; set up to track remote branch &apos;bugfix1&apos; from &apos;origin&apos;.</span><br></pre></td></tr></table></figure>
<h4 id="场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干"><a href="#场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干" class="headerlink" title="场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干"></a>场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干</h4><blockquote>
<p>git checkout master<br>git merge bugfix1 (若遇到处理冲突，需要解决冲突后，重新提交)<br>git push</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git branch</span><br><span class="line">* bugfix1</span><br><span class="line">  master</span><br><span class="line">localhost:bookstore liaoxb$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/master&apos;.</span><br><span class="line">localhost:bookstore liaoxb$ git merge bugfix1</span><br><span class="line">Updating d369e85..2eafe98</span><br><span class="line">Fast-forward</span><br><span class="line"> test.txt | 4 +---</span><br><span class="line"> 1 file changed, 1 insertion(+), 3 deletions(-)</span><br><span class="line">localhost:bookstore liaoxb$ git push</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line">   d369e85..2eafe98  master -&gt; master</span><br></pre></td></tr></table></figure>
<h4 id="场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性"><a href="#场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性" class="headerlink" title="场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性"></a>场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性</h4><blockquote>
<p>git checkout cmft<br>git log检索目标commit id<br>git checkout master<br>git cherry-pick <commit id> (若遇到处理冲突，需要解决冲突后，重新提交)<br>git push</commit></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">localhost:wise2c-robot liaoxb$ git checkout cmft</span><br><span class="line">Already on &apos;cmft&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/cmft&apos;.</span><br><span class="line">localhost:wise2c-robot liaoxb$</span><br><span class="line">localhost:wise2c-robot liaoxb$ git log |grep efa8009d8ce0d9c6e3fb6bae3d2cfdd9f56ea7fd -C 4</span><br><span class="line">Date:   Fri Nov 15 16:44:20 2019 +0800</span><br><span class="line"></span><br><span class="line">    Merge branch &apos;cmft&apos; of gitee.com:wisecloud/wise2c-robot into cmft</span><br><span class="line"></span><br><span class="line">commit efa8009d8ce0d9c6e3fb6bae3d2cfdd9f56ea7fd</span><br><span class="line">Author: liaoxb &lt;1219199895@qq.com&gt;</span><br><span class="line">Date:   Fri Nov 15 16:41:16 2019 +0800</span><br><span class="line"></span><br><span class="line">    优化关键字Initialize Cluster&amp;完成ingress分组脚本</span><br><span class="line">localhost:wise2c-robot liaoxb$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/master&apos;.</span><br><span class="line">localhost:wise2c-robot liaoxb$</span><br><span class="line">localhost:wise2c-robot liaoxb$ git cherry-pick efa8009d8ce0d9c6e3fb6bae3d2cfdd9f56ea7fd</span><br><span class="line">error: could not apply efa8009... 优化关键字Initialize Cluster&amp;完成ingress分组脚本</span><br><span class="line">hint: after resolving the conflicts, mark the corrected paths</span><br><span class="line">hint: with &apos;git add &lt;paths&gt;&apos; or &apos;git rm &lt;paths&gt;&apos;</span><br><span class="line">hint: and commit the result with &apos;git commit&apos;</span><br></pre></td></tr></table></figure>
<h4 id="场景四：从本地和远端删除已经废弃了的bugfix1分支"><a href="#场景四：从本地和远端删除已经废弃了的bugfix1分支" class="headerlink" title="场景四：从本地和远端删除已经废弃了的bugfix1分支"></a>场景四：从本地和远端删除已经废弃了的bugfix1分支</h4><blockquote>
<p>git branch -r -d origin/branch-name<br>git push origin :branch-name<br>（一般情况下慎用）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git branch -r</span><br><span class="line">  origin/HEAD -&gt; origin/master</span><br><span class="line">  origin/bugfix1</span><br><span class="line">  origin/master</span><br><span class="line">localhost:bookstore liaoxb$ git branch -r -d origin/bugfix1</span><br><span class="line">Deleted remote-tracking branch origin/bugfix1 (was 2eafe98).</span><br><span class="line">localhost:bookstore liaoxb$ git push origin :bugfix1</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line"> - [deleted]         bugfix1</span><br><span class="line">localhost:bookstore liaoxb$ git branch -r</span><br><span class="line">  origin/HEAD -&gt; origin/master</span><br><span class="line">  origin/master</span><br></pre></td></tr></table></figure>
<h4 id="场景五：master分支引入了错误代码，需要回退至某次提交"><a href="#场景五：master分支引入了错误代码，需要回退至某次提交" class="headerlink" title="场景五：master分支引入了错误代码，需要回退至某次提交"></a>场景五：master分支引入了错误代码，需要回退至某次提交</h4><blockquote>
<p>git log检索需要回退的目标<commit id><br>git reset –hard <commit id><br>git push –force</commit></commit></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git reset d369e856336a93979f5b9292557f2c7d9b66080b</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M	test.txt</span><br><span class="line">ocalhost:bookstore liaoxb$ git push --force</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line"> + 2eafe98...d369e85 master -&gt; master (forced update)</span><br></pre></td></tr></table></figure>
<h4 id="场景六：git-pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码"><a href="#场景六：git-pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码" class="headerlink" title="场景六：git pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码"></a>场景六：git pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">error: Your local changes to the following files would be overwritten by merge:</span><br><span class="line">	test.txt</span><br><span class="line">Please commit your changes or stash them before you merge.</span><br><span class="line">Aborting</span><br><span class="line">localhost:bookstore liaoxb$</span><br><span class="line">localhost:bookstore liaoxb$ echo &apos;local change test&apos; &gt; test.txt</span><br><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">error: Your local changes to the following files would be overwritten by merge:</span><br><span class="line">	test.txt</span><br><span class="line">Please commit your changes or stash them before you merge.</span><br><span class="line">Aborting</span><br></pre></td></tr></table></figure>
<blockquote>
<p>git stash 暂存本地的代码修改<br>git pull 拉取远端最新代码<br>git stash pop 合并暂存的本地代码，解决已冲突的文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git stash</span><br><span class="line">Saved working directory and index state WIP on master: d369e85 update</span><br><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">Fast-forward</span><br><span class="line"> test.txt | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">localhost:bookstore liaoxb$ git stash pop</span><br><span class="line">Auto-merging test.txt</span><br><span class="line">CONFLICT (content): Merge conflict in test.txt</span><br></pre></td></tr></table></figure>
<h4 id="场景七：git-pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码"><a href="#场景七：git-pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码" class="headerlink" title="场景七：git pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码"></a>场景七：git pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码</h4><blockquote>
<p>git reset –hard 回滚到上个版本<br>git pull</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git reset --hard</span><br><span class="line">HEAD is now at d369e85 update</span><br><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">Fast-forward</span><br><span class="line"> test.txt | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/20/how_to_make_at/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/20/how_to_make_at/" itemprop="url">如何搭建自动化测试体系</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-20T23:02:56+08:00">
                2019-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自动化测试跟其它任何一种测试类型（比如异常测试、稳定性测试、性能测试等）都是类似的，它也是一种测试类型而已。在开展测试之前，我们首先必须要明确自动化测试的需求是什么，要解决什么样的问题。</p>
<h2 id="一、明确需求"><a href="#一、明确需求" class="headerlink" title="一、明确需求"></a>一、明确需求</h2><p>核心需求：“自动化”代替“手动”，提高测试效率</p>
<p>核心理念：</p>
<p>1、明确自动化收益。即每完成一条自动化用例，就减少了一条手工用例的执行时间。</p>
<p>2、每次回归或上线验证必须执行的用例优先自动化，让自动化收益最大化</p>
<p>3、确保新增用例是稳定100%通过前提下才被增加至用例集</p>
<p>4、自动化不可能完全代替手动</p>
<p>5、不要让环境问题成为瓶颈</p>
<h2 id="二、技术选型"><a href="#二、技术选型" class="headerlink" title="二、技术选型"></a>二、技术选型</h2><p>1、首先要分析项目的架构和状况</p>
<p>2、对于后端的服务，它如果是纯粹以接口的形式提供给其它组件去调用，那可以采取“接口自动化”</p>
<p>3、对于Web产品，如果前后端都在测试的保障范围，而且前端页面相对比较稳定，可以考虑采用“UI自动化”</p>
<p>4、最后测试技术栈选择python还是java，必须考虑团队成员的语言偏好和熟练程度</p>
<h2 id="三、自动化实施过程"><a href="#三、自动化实施过程" class="headerlink" title="三、自动化实施过程"></a>三、自动化实施过程</h2><h3 id="实施目标"><a href="#实施目标" class="headerlink" title="实施目标"></a>实施目标</h3><ul>
<li><p>同一份代码可以在多个集群执行</p>
</li>
<li><p>各个集群的测试数据相互独立，不会互相影响</p>
</li>
<li><p>可以方便地与数据库进行交互</p>
</li>
<li><p>当用例执行出错时，有详细的日志帮助定位</p>
</li>
<li><p>较好的可维护性和集群扩展性</p>
</li>
</ul>
<p>目前我跟的项目已经实现自动化的内容如下：</p>
<ul>
<li>基于接口的场景回归自动化测试</li>
<li>编译部署过程自动化</li>
<li>接入CICD平台跑自动化冒烟测试</li>
</ul>
<p>有计划未来要实现的自动化如下：</p>
<ul>
<li>接入CR平台（代码变更分析平台）的自动化</li>
<li>对外/上线打包发布的自动化</li>
</ul>
<h3 id="具体工作"><a href="#具体工作" class="headerlink" title="具体工作"></a>具体工作</h3><p>框架搭建时，主要用了以下工具：</p>
<ul>
<li>gitee：管理多分支代码</li>
<li>Robot Framework：作为测试框架</li>
<li>docker：打包测试脚本和python包依赖，构建测试镜像</li>
</ul>
<p>配置数据管理</p>
<ul>
<li><p>目前是把不同的测试集群信息放在wisecloud.yaml文件里管理，另外basedata.py文件管理其它配置数据。比如公共登录账号、harbor地址账号等。</p>
</li>
<li><p>配置读取：单独创建一个Rest类，并继承REST父类。get_baseurl实例方法会根据env_type变量值，去动态获取目标集群的访问地址、集群ip地址,并调用BuiltIn().set_global_variable方法去设为全局变量。供用例执行过程中使用</p>
</li>
</ul>
<p>分层设计与解耦</p>
<ul>
<li>用例、方法（关键字）、测试库分层</li>
<li>用例按模块划分成多个测试用例文件，集中放进测试套件Suites</li>
<li>方法按模块划分成多个资源文件，集中放进资源文件夹Resource</li>
<li>自定义创建测试库和方法，集中放进Library。以关键字的形式以供调用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">├── Library</span><br><span class="line">│   ├── Basedata.py</span><br><span class="line">│   ├── Rest.py</span><br><span class="line">│   ├── ServiceAdd.py</span><br><span class="line">│   └── wisecloud.yaml</span><br><span class="line">├── Resource</span><br><span class="line">│   ├── BackupRestore.robot</span><br><span class="line">│   ├── Common.robot</span><br><span class="line">│   ├── Configcenter.robot</span><br><span class="line">│   ├── Dashboard.robot</span><br><span class="line">│   ├── Monitor.robot</span><br><span class="line">│   ├── Orche_App.robot</span><br><span class="line">│   ├── Orche_Stack.robot</span><br><span class="line">│   ├── Resource_Manager.robot</span><br><span class="line">│   ├── Workflow.robot</span><br><span class="line">│   └── pipeline_workflow.robot</span><br><span class="line">├── Suites</span><br><span class="line">│   ├── backuprestore.robot</span><br><span class="line">│   ├── configcenter.robot</span><br><span class="line">│   ├── dashboard.robot</span><br><span class="line">│   ├── ingress</span><br><span class="line">│   │   └── ingress.robot</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="改进与提升"><a href="#改进与提升" class="headerlink" title="改进与提升"></a>改进与提升</h3><ul>
<li>用例并发执行，解决用例耗时问题</li>
<li>统一配置数据文件，放在资源文件夹里</li>
<li>单例模式，解决用例频繁依赖登录接口组装header的问题</li>
<li>解决一切脚本不稳定问题</li>
</ul>
<h2 id="四、自动化在研发阶段的应用"><a href="#四、自动化在研发阶段的应用" class="headerlink" title="四、自动化在研发阶段的应用"></a>四、自动化在研发阶段的应用</h2><h3 id="持续集成自动化测试"><a href="#持续集成自动化测试" class="headerlink" title="持续集成自动化测试"></a>持续集成自动化测试</h3><p>狭义的理解是每次开发提交代码，自动触发构建和测试。</p>
<p>但是在实际项目中并不是这样玩的，实际落地的CI测试可能是每日1次或者每周1次，这完全取决于产品形态和团队的研发流程而定。</p>
<h3 id="作为开发冒烟的一部分（未完成）"><a href="#作为开发冒烟的一部分（未完成）" class="headerlink" title="作为开发冒烟的一部分（未完成）"></a>作为开发冒烟的一部分（未完成）</h3><p>目前已经跟开发达成一致，开发非常欢迎将自动化用例接入到开发环境，用于他们每次变更时的环境正确性验证，可以尽早帮助他们发现研发过程中出现的问题。并且在提测前，只有100%通过自动化测试才可以进行提测。</p>
<h2 id="五、自动化在测试阶段的应用"><a href="#五、自动化在测试阶段的应用" class="headerlink" title="五、自动化在测试阶段的应用"></a>五、自动化在测试阶段的应用</h2><h3 id="版本提测后的自动化回归验收"><a href="#版本提测后的自动化回归验收" class="headerlink" title="版本提测后的自动化回归验收"></a>版本提测后的自动化回归验收</h3><p>在开发提测后，我会自动化地完成以下事情：</p>
<ul>
<li>流水线拉取测试代码</li>
<li>构建测试镜像</li>
<li>执行自动化测试</li>
<li>查看测试结果报告</li>
</ul>
<p>当自动化用例全部执行通过时，说明系统的核心功能回归没有问题，然后开始版本的细粒度功能的测试。</p>
<h3 id="版本Bug修复后的回归验收"><a href="#版本Bug修复后的回归验收" class="headerlink" title="版本Bug修复后的回归验收"></a>版本Bug修复后的回归验收</h3><p>在测试过程中，开发肯定会经常修复bug重新提交代码，每次有代码重新提交时，我都可以自动编译部署pr镜像。</p>
<h2 id="六、成效"><a href="#六、成效" class="headerlink" title="六、成效"></a>六、成效</h2><p>已实现的成效如下</p>
<ul>
<li><p>自动编译部署：测试过程中开发修复bug提交代码是非常频繁的，每次的手动编译部署可能都会耗费十几分钟，并且测试人员的关注点还不能离开。</p>
</li>
<li><p>自动化回归测试：以前一次回归测试，需要QA持续地投入超过30分钟。现在通过一键执行，程序会自动地执行，时间控制在5分钟以内。且QA可以将注意力放到其它事情上。</p>
</li>
</ul>
<p>正在计划、可预见的成效：</p>
<ul>
<li>自动打包发布：目前都是人工利用shell脚本retag&amp;push版本镜像到发布仓库中，还必须把注意力投入其中去检查是否有遗漏。计划利用流水线job去做好这件事</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/01/kubernetes-v1.16.4-deploy-by-kubeadm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/01/kubernetes-v1.16.4-deploy-by-kubeadm/" itemprop="url">使用kubeadm部署K8S集群v1.16.4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-01T22:00:56+08:00">
                2019-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="环境准备工作"><a href="#环境准备工作" class="headerlink" title="环境准备工作"></a>环境准备工作</h1><h2 id="环境角色"><a href="#环境角色" class="headerlink" title="环境角色"></a>环境角色</h2><table>
<thead>
<tr>
<th>IP</th>
<th>角色</th>
<th>软件安装 </th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.0.16</td>
<td>K8S Master</td>
<td>kube-apiserver kube-schduler kube-controller-manager kube-proxy docker flannel kubelet etcd</td>
</tr>
<tr>
<td>192.168.0.17</td>
<td>K8s Node</td>
<td>kubelet kube-proxy docker flannel</td>
</tr>
<tr>
<td>192.168.0.18</td>
<td>K8s Node</td>
<td>kubelet kube-proxy docker flannel</td>
</tr>
</tbody>
</table>
<blockquote>
<p>以下所有1.x操作,在三台节点都执行</p>
</blockquote>
<h2 id="统一设置主机名"><a href="#统一设置主机名" class="headerlink" title="统一设置主机名"></a>统一设置主机名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hostnamectl set-hostname test01</span><br><span class="line">$ hostnamectl set-hostname test02</span><br><span class="line">$ hostnamectl set-hostname test03</span><br></pre></td></tr></table></figure>
<h2 id="部署机免密登录到test01、test02、test03"><a href="#部署机免密登录到test01、test02、test03" class="headerlink" title="部署机免密登录到test01、test02、test03"></a>部署机免密登录到test01、test02、test03</h2><blockquote>
<p>前提是目标主机需要生成公钥以及密钥 ssh-keygen -t rsa</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@test02</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">The authenticity of host &apos;test02 (192.168.0.17)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:Omg7RAlyXPvDcwNyJdufEmAMHnwcS3eh/gsaHPZVP6I.</span><br><span class="line">ECDSA key fingerprint is MD5:5d:55:0f:b2:75:4d:39:ee:47:c1:a8:3f:0f:12:96:30.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@test02&apos;s password:</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &apos;root@test02&apos;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/12/01/kubernetes-v1.16.4-deploy-by-kubeadm/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/18/mysql_backup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/18/mysql_backup/" itemprop="url">Mysql数据备份</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-18T18:02:56+08:00">
                2019-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="快速复制表的完整结构和数据"><a href="#快速复制表的完整结构和数据" class="headerlink" title="快速复制表的完整结构和数据"></a>快速复制表的完整结构和数据</h2><p>在mysql表复制时，其实可以直接用命令’CREATE TABLE 新表 AS SELECT * FROM 旧表’，但是MySQL5.7.x版本里面gtid是开启的，会报以下错误错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table user_backup as select * from user;</span><br><span class="line">ERROR 1786 (HY000): Statement violates GTID consistency: CREATE TABLE ... SELECT.</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>解决办法参考 <a href="https://www.unixso.com/MySQL/gtid_mode-enforce_gtid_consistency.html" target="_blank" rel="noopener">https://www.unixso.com/MySQL/gtid_mode-enforce_gtid_consistency.html</a></p>
</blockquote>
<p>方法一：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 第一步：只复制表结构，命名新表为user_backup</span><br><span class="line">mysql&gt; create table user_backup like user;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line"># 第二步，只复制表数据，且两张表结构一模一样</span><br><span class="line">mysql&gt; insert into user_backup select * from user;</span><br><span class="line">Query OK, 4 rows affected (0.01 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure></p>
<p>方法二：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 第一步：获取数据表的完整结构</span><br><span class="line">mysql&gt; show create table user \G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: user</span><br><span class="line">Create Table: CREATE TABLE `user` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `created_at` datetime DEFAULT NULL,</span><br><span class="line">  `disable` bit(1) NOT NULL,</span><br><span class="line">  `email` varchar(255) DEFAULT NULL,</span><br><span class="line">  `is_admin` bit(1) NOT NULL,</span><br><span class="line">  `ldap_source` bigint(20) DEFAULT NULL,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `nickname` varchar(255) DEFAULT NULL,</span><br><span class="line">  `updated_at` datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `UK_gj2fy3dcix7ph7k8684gka40c` (`name`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=43 DEFAULT CHARSET=utf8</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line">#第二步，修改SQL语句的表名，并执行SQL语句</span><br><span class="line">mysql&gt; CREATE TABLE `user_backup1` (</span><br><span class="line">    -&gt;   `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">    -&gt;   `created_at` datetime DEFAULT NULL,</span><br><span class="line">    -&gt;   `disable` bit(1) NOT NULL,</span><br><span class="line">    -&gt;   `email` varchar(255) DEFAULT NULL,</span><br><span class="line">    -&gt;   `is_admin` bit(1) NOT NULL,</span><br><span class="line">    -&gt;   `ldap_source` bigint(20) DEFAULT NULL,</span><br><span class="line">    -&gt;   `name` varchar(255) NOT NULL,</span><br><span class="line">    -&gt;   `nickname` varchar(255) DEFAULT NULL,</span><br><span class="line">    -&gt;   `updated_at` datetime DEFAULT NULL,</span><br><span class="line">    -&gt;   PRIMARY KEY (`id`),</span><br><span class="line">    -&gt;   UNIQUE KEY `UK_gj2fy3dcix7ph7k8684gka40c` (`name`)</span><br><span class="line">    -&gt; ) ENGINE=InnoDB AUTO_INCREMENT=43 DEFAULT CHARSET=utf8;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">#第三步：INSERT INTO... SELECT 语句来实现拷贝数据</span><br><span class="line">mysql&gt; insert into user_backup1 select * from user;</span><br><span class="line">Query OK, 4 rows affected (0.01 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure></p>
<h2 id="导出表"><a href="#导出表" class="headerlink" title="导出表"></a>导出表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@Master:/# mysqldump -uwise2c -p bldr user &gt; user_bak.sql</span><br><span class="line">Enter password:</span><br><span class="line">Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions, even those that changed suppressed parts of the database. If you don&apos;t want to restore GTIDs, pass --set-gtid-purged=OFF. To make a complete dump, pass --all-databases --triggers --routines --events.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当前数据库实例中开启了 GTID 功能, 在开启有 GTID 功能的数据库实例中, 导出其中任何一个库, 如果没有显示地指定–set-gtid-purged参数, 都会提示这一行信息. 意思是默认情况下, 导出的库中含有 GTID 信息, 如果不想导出包含有 GTID 信息的数据库,需要显示地添加–set-gtid-purged=OFF参数.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 加上--set-gtid-purged=OFF参数</span><br><span class="line">root@Master:/# mysqldump -uwise2c -p --set-gtid-purged=OFF bldr user &gt; user_bak.sql</span><br><span class="line">Enter password:</span><br><span class="line">root@Master:/# ls user*</span><br><span class="line">user_bak.sql</span><br></pre></td></tr></table></figure>
<h2 id="导入表"><a href="#导入表" class="headerlink" title="导入表"></a>导入表</h2><p>方法一：mysql命令导入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@Master:/# mysql -uwise2c -p bldr &lt; user_bak.sql</span><br><span class="line">Enter password:</span><br></pre></td></tr></table></figure></p>
<p>方法二：source命令导入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@Master:/# mysql -uwise2c -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line"></span><br><span class="line">mysql&gt; use bldr;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; source user_bak.sql</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="导出数据库"><a href="#导出数据库" class="headerlink" title="导出数据库"></a>导出数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@Master:/# mysqldump -uwise2c -p --set-gtid-purged=OFF builderdb &gt; bak.sql</span><br><span class="line">Enter password:</span><br></pre></td></tr></table></figure>
<h2 id="导入数据库"><a href="#导入数据库" class="headerlink" title="导入数据库"></a>导入数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@Master:/# mysql -uwise2c -p builderdb &lt; bak.sql</span><br><span class="line">Enter password:</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/29/jenkins-ci-apitest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/29/jenkins-ci-apitest/" itemprop="url">使用Jenkins搭建CI自动化测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-29T22:13:44+08:00">
                2019-03-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><p>1、公司项目搭建了一套CICD，每天可以自动地构建镜像并部署至测试环境，这时需要对接CI自动化冒烟测试<br>2、Jenkins有着其丰富的插件和job触发机制，易于拓展，能够满足持续测试的大部分场景，尤其是jenkins pipeline使得创建任务非常灵活和简洁，最终选择jenkins作为持续集成测试平台</p>
<h1 id="安装和配置Jenkins"><a href="#安装和配置Jenkins" class="headerlink" title="安装和配置Jenkins"></a>安装和配置Jenkins</h1><h2 id="jenkins容器安装"><a href="#jenkins容器安装" class="headerlink" title="jenkins容器安装"></a>jenkins容器安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在docker主机上执行命令：</span><br><span class="line">docker run -u root -d  --name jenkins-ci -p 8081:8080 -p 50000:50000 -v /etc/localtime:/etc/localtime -v /etc/timezone:/etc/timezone -v jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock  jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果宿主机不存在timezone文件，自己手动创建并写入Asia/Shanghai即可。<br>docker run参数的具体说明请看官方文档，介绍得很详细。<a href="https://jenkins.io/zh/doc/book/installing/" target="_blank" rel="noopener">https://jenkins.io/zh/doc/book/installing/</a></p>
</blockquote>
<p>执行命令截图：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk01.png?raw=true" alt="jk.png"></p>
<p>为了省心方便，在此默认选择了jenkins推荐的插件安装,这需要耐心等待一段时间：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk02.png?raw=true" alt="jk.png"></p>
<h2 id="配置邮件通知"><a href="#配置邮件通知" class="headerlink" title="配置邮件通知"></a>配置邮件通知</h2><p>这里特别注意的是密码应该填qq邮箱的授权码，填写完毕测试一下邮件发送成功即可<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk03.png?raw=true" alt="jk.png"></p>
<h2 id="安装插件robot-framework"><a href="#安装插件robot-framework" class="headerlink" title="安装插件robot-framework"></a>安装插件robot-framework</h2><p>由于项目里的自动化脚本基于RF编写开发，所以Jenkins需要安装这个插件。该插件在Jenkins中收集并发布Robot Framework测试结果。bfyrjbqkzqvaibjd<br>至此，jenkins的基本配置工作就算完了，接下来最核心就是编写pipeline脚本。</p>
<h1 id="编写Pipeline脚本"><a href="#编写Pipeline脚本" class="headerlink" title="编写Pipeline脚本"></a>编写Pipeline脚本</h1><p>直接贴脚本，pipeline支持的语法请查看官方手册。</p>
<p>pipeline流程图：</p>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk09.png?raw=true" alt="jk.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    options &#123;</span><br><span class="line">        // 添加日志打印时间</span><br><span class="line">        timestamps()</span><br><span class="line">        // 设置全局超时间</span><br><span class="line">        // timeout(time:10,unit:&apos;MINUTES&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123;</span><br><span class="line">        // GIT_BRANCH = &apos;master&apos; # 已设置全局变量</span><br><span class="line">        GIT_USER_ID = &apos;76f84542-2dba-4128-8651-bed7a849eddd&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;Git Clone&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                // sh  &apos;printenv |sort&apos;</span><br><span class="line">                git branch: &quot;$&#123;GIT_BRANCH&#125;&quot;, credentialsId: &quot;$&#123;GIT_USER_ID&#125;&quot;, url: &apos;https://gitee.com/wisecloud/wise2c-robot.git&apos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&apos;Build Image&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &apos;docker build -t $&#123;JOB_NAME&#125;:$&#123;GIT_BRANCH&#125; .&apos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&apos;API Test&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script&#123;</span><br><span class="line">                    sh &apos;ls -a&apos;</span><br><span class="line">                    sh &apos;docker run --rm -v jenkins-data:/robot-results --name $&#123;JOB_NAME&#125; $&#123;JOB_NAME&#125;:$&#123;GIT_BRANCH&#125; robot --outputdir /robot-results /wise2c-robot/Project/Suites/resource_manager.robot&apos;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            echo &apos;Publish Test Report&apos;</span><br><span class="line">            robot logFileName: &apos;log.html&apos;, outputFileName: &apos;output.xml&apos;, outputPath: &apos;/var/jenkins_home/&apos;, passThreshold: 100.0, reportFileName: &apos;report.html&apos;, unstableThreshold: 90.0</span><br><span class="line">            // deleteDir() /* clean up our workspace */</span><br><span class="line">        &#125;</span><br><span class="line">        success &#123;</span><br><span class="line">            mail bcc: &apos;&apos;, body: &quot;API自动化测试通过\n测试版本分支：$&#123;GIT_BRANCH&#125;\n测试报告地址：$&#123;BUILD_URL&#125;&quot;, cc: &apos;&apos;, from: &apos;1219199895@qq.com&apos;, replyTo: &apos;&apos;, subject: &quot;$&#123;JOB_NAME&#125;测试报告&quot;, to: &apos;liaoxb@wise2c.com&apos;</span><br><span class="line">        &#125;</span><br><span class="line">        failure &#123;</span><br><span class="line">            mail bcc: &apos;&apos;, body: &quot;API自动化测试未通过，请相关模块的同事分析定位问题，谢谢大家。\n测试版本分支：$&#123;GIT_BRANCH&#125;\n测试报告地址：$&#123;BUILD_URL&#125;&quot;, cc: &apos;&apos;, from: &apos;1219199895@qq.com&apos;, replyTo: &apos;&apos;, subject: &quot;$&#123;JOB_NAME&#125;测试报告&quot;, to: &apos;liaoxb@wise2c.com&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="webhook自动触发Jenkins-pipeline"><a href="#webhook自动触发Jenkins-pipeline" class="headerlink" title="webhook自动触发Jenkins pipeline"></a>webhook自动触发Jenkins pipeline</h1><p>1、新建pipeline时，构建触发器选择‘触发远程构建’这项，输入token name。比如apitest<br>这时就可以获得一个webhhok地址，提供给维护CICD平台的同事即可。<br>2、把pipeline脚本内容粘贴到流水线里，检查下有没有语法错误，最后点击保存<br>3、现在可以用curl模拟发送一次webhhok请求，不过记得临时把全局安全配置里的授权策略给放开，改成没有任何限制。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl JENKINS_URL/job/wise2c-robot/build?token=TOKEN_NAME</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk05.png?raw=true" alt="jk.png"></p>
<h1 id="测试结果报告展示"><a href="#测试结果报告展示" class="headerlink" title="测试结果报告展示"></a>测试结果报告展示</h1><p>job首页测试结果展示，失败了1条case，同时收到了一封关于api测试失败的邮件通知：</p>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk04.png?raw=true" alt="jk.png"><br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk07.png?raw=true" alt="jk.png"></p>
<p>测试结果详情页面展示，点击log.html链接可以直接查看日志；</p>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk06.png?raw=true" alt="jk.png"><br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk08.png?raw=true" alt="jk.png"></p>
<p>注：如果到打开失败，可以参考这个解决办法。<a href="https://stackoverflow.com/questions/36607394/error-opening-robot-framework-log-failed" target="_blank" rel="noopener">https://stackoverflow.com/questions/36607394/error-opening-robot-framework-log-failed</a><br>管理jenkins–&gt;脚本命令行输入如下脚本:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(&quot;hudson.model.DirectoryBrowserSupport.CSP&quot;,&quot;sandbox allow-scripts; default-src &apos;none&apos;; img-src &apos;self&apos; data: ; style-src &apos;self&apos; &apos;unsafe-inline&apos; data: ; script-src &apos;self&apos; &apos;unsafe-inline&apos; &apos;unsafe-eval&apos; ;&quot;)</span><br></pre></td></tr></table></figure></p>
<h1 id="持续改进"><a href="#持续改进" class="headerlink" title="持续改进"></a>持续改进</h1><p>1、目前创建的wise2c-robot任务脚本数量500+，全部跑完至少需要2个小时，后期打算按模块拆分成多个子任务job，并行执行测试。</p>
<p>2、邮件通知的正文内容过于简单，希望能把每条case的执行结果直接展示出来</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/04/kubernetes-monitoring-by-prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/04/kubernetes-monitoring-by-prometheus/" itemprop="url">Kubernetes集群监控</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T23:00:56+08:00">
                2019-03-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在实际工作中，通过prometheus监控的主要对象有如下几个：</p>
<ul>
<li>基础设施层：主要是监控k8s节点资源，如CPU,内存,网络吞吐和带宽占用,磁盘I/O和磁盘使用等指标；</li>
<li>中间件层：监控产品使用到的中间件（一般会独立部署在外部集群），主要有consul、mysql、nats、redis、haproxy</li>
<li>Kubernetes集群：监控Kubernetes集群本身的关键指标</li>
<li>Kubernetes集群上部署的应用：监控部署在Kubernetes集群上的应用（pod或container等）</li>
</ul>
<p>Step By Step，部署工作正式开始！<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/03/04/kubernetes-monitoring-by-prometheus/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </p></div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/24/nginx-worknote-proxy-for-monitor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/24/nginx-worknote-proxy-for-monitor/" itemprop="url">nginx工作笔记：配置反向代理访问监控系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-24T22:33:44+08:00">
                2019-01-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><p>1、测试环境部署了一套监控系统，测试人员经常需要访问web去分析数据或定位问题，但是访问不方便也不灵活,每次需要去找到pod运行主机IP和svc暴露的端口。<br>2、通过利用nginx反向代理+负载均衡配置，快速地访问系统。比如prometheus、granfana等</p>
<h1 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h1><p>1、查看测试集群监控服务的pod和svc信息，prometheus和grafana均以NodePort的形式映射到主机端口。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|kubernetes-admin@q4-default# kcc get po,svc |grep grafana</span><br><span class="line">pod/grafana-6c5f687b5b-79qf8                         1/1       Running     0          56m</span><br><span class="line"></span><br><span class="line">service/grafana                         NodePort    10.104.106.121   &lt;none&gt;        3000:31962/TCP      12d</span><br><span class="line">|kubernetes-admin@q4-default# kca get po,svc |grep prometheus</span><br><span class="line">pod/prometheus-68d7459bb-cmnmn                  5/5       Running   0          2d</span><br><span class="line"></span><br><span class="line">service/prometheus                 NodePort    10.99.169.156   &lt;none&gt;        81:32001/TCP,9093:32003/TCP   2d</span><br></pre></td></tr></table></figure></p>
<p>这时是可以通过集群内主机内网ip+端口，成功访问到监控系统。比如访问prometheus端口32001<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor nginx-proxy]# curl 192.168.0.34:32001</span><br><span class="line">&lt;a href=&quot;/graph&quot;&gt;Found&lt;/a&gt;.</span><br><span class="line"></span><br><span class="line">[root@harbor nginx-proxy]# curl 192.168.0.35:32001</span><br><span class="line">&lt;a href=&quot;/graph&quot;&gt;Found&lt;/a&gt;.</span><br><span class="line"></span><br><span class="line">[root@harbor nginx-proxy]# curl 192.168.0.36:32001</span><br><span class="line">&lt;a href=&quot;/graph&quot;&gt;Found&lt;/a&gt;.</span><br></pre></td></tr></table></figure></p>
<p>2、nginx配置文件如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor nginx-proxy]# cat default.conf</span><br><span class="line">    # 设定实际的后端服务器列表</span><br><span class="line">    upstream prometheus_server&#123;</span><br><span class="line">	    #设定负载均衡的服务器列表，weigth参数表示权值（缺省是1），权值越高被分配到的几率越大</span><br><span class="line">        server 192.168.0.34:32001 weight=1;</span><br><span class="line">        server 192.168.0.35:32001 weight=2;</span><br><span class="line">        server 192.168.0.36:32001 weight=3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream alert_server&#123;</span><br><span class="line">        server 192.168.0.34:32003;</span><br><span class="line">        server 192.168.0.35:32003;</span><br><span class="line">        server 192.168.0.36:32003;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream grafana_server&#123;</span><br><span class="line">        server  192.168.0.34:31962;</span><br><span class="line">        #server 192.168.0.35:31962;</span><br><span class="line">        #server 192.168.0.36:31962;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        #监听80端口，用于HTTP协议</span><br><span class="line">        listen       80;</span><br><span class="line">        #定义使用www.test.com访问</span><br><span class="line">        server_name  www.test.com;</span><br><span class="line">        proxy_headers_hash_max_size     51200;</span><br><span class="line">        proxy_headers_hash_bucket_size  6400;</span><br><span class="line">        proxy_set_header                Host             $host;</span><br><span class="line">        proxy_set_header                X-Real-IP        $remote_addr;</span><br><span class="line">        proxy_set_header                X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">        #location / &#123;</span><br><span class="line">        #    root /usr/share/nginx/html;</span><br><span class="line">        #    index index.html;</span><br><span class="line">        #&#125;</span><br><span class="line">        #反向代理的路径</span><br><span class="line">        location / &#123;</span><br><span class="line">            #请求将转向upstream里prometheus_server定义的服务器列表</span><br><span class="line">            proxy_pass  http://prometheus_server/;</span><br><span class="line">            #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">            proxy_connect_timeout     30s;</span><br><span class="line">        &#125;</span><br><span class="line">        location /alert/ &#123;</span><br><span class="line">            proxy_pass  http://alert_server/;</span><br><span class="line">            proxy_connect_timeout     30s;</span><br><span class="line">        &#125;</span><br><span class="line">        location /grafana/ &#123;</span><br><span class="line">            proxy_pass  http://grafana_server/;</span><br><span class="line">            proxy_connect_timeout     30s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>3、make run快速启动nginx容器<br>Makefile里总共三步操作：<br>快速启动nginx容器，映射到主机端口8081，<br>拷贝default.conf到nginx容器/etc/nginx/conf.d/目录<br>重启nginx容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor nginx-proxy]# ll</span><br><span class="line">总用量 12</span><br><span class="line">-rw-r--r-- 1 root root 1587 1月  24 21:39 default_backup.conf</span><br><span class="line">-rw-r--r-- 1 root root 1327 1月  24 21:40 default.conf</span><br><span class="line">-rw-r--r-- 1 root root  353 1月  24 21:44 Makefile</span><br><span class="line">[root@harbor nginx-proxy]# make run</span><br><span class="line">docker rm -f nginx-web</span><br><span class="line">nginx-web</span><br><span class="line">docker run -d -p 8081:80 --name nginx-web nginx</span><br><span class="line">229484284a78d84800527337eb7a074d42ff62987cb8e479a0d6c4c65b586156</span><br><span class="line">docker cp default.conf nginx-web:/etc/nginx/conf.d/</span><br><span class="line">docker restart nginx-web</span><br><span class="line">nginx-web</span><br><span class="line">[root@harbor nginx-proxy]# docker ps |grep nginx-web</span><br><span class="line">229484284a78        nginx                                                                 &quot;nginx -g &apos;daemon ...&quot;   30 seconds ago      Up 29 seconds          0.0.0.0:8081-&gt;80/tcp                                               nginx-web</span><br></pre></td></tr></table></figure>
<p>4、在浏览器中访问 <a href="http://www.test.com，这时应该就可以根据location，访问到不同的服务了。" target="_blank" rel="noopener">www.test.com，这时应该就可以根据location，访问到不同的服务了。</a><br>访问Grafana Dashboard：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx15.png?raw=true" alt="7.png"><br>访问Alertmanager ui：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx16.png?raw=true" alt="7.png"><br>访问:Prometheus ui<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx17.png?raw=true" alt="7.png"></p>
<h1 id="关于负载均衡策略"><a href="#关于负载均衡策略" class="headerlink" title="关于负载均衡策略"></a>关于负载均衡策略</h1><p>Nginx提供了多种负载均衡策略，在上面其实已用到过轮询算法。在这里延伸多了解一下其它策略。</p>
<h2 id="轮询"><a href="#轮询" class="headerlink" title="轮询"></a>轮询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  # 默认所有服务器权重为 1</span><br><span class="line">  server 192.168.250.220:8080</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="加权轮询"><a href="#加权轮询" class="headerlink" title="加权轮询"></a>加权轮询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  server 192.168.250.220:8080  weight=3</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最少连接"><a href="#最少连接" class="headerlink" title="最少连接"></a>最少连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  least_conn;</span><br><span class="line">  server 192.168.250.220:8080</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="IP-Hash"><a href="#IP-Hash" class="headerlink" title="IP Hash"></a>IP Hash</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  ip_hash;</span><br><span class="line">  server 192.168.250.220:8080</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考文档：<br><a href="https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html" target="_blank" rel="noopener">https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html</a><br><a href="https://mp.weixin.qq.com/s/qMtJtZ6g62wibRVilIHPNg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/qMtJtZ6g62wibRVilIHPNg</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">liaoxb</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liaoxb</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Liaoxb&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Liaoxb&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Liaoxb&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Liaoxb's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Liaoxb's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/23/selenium-grid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/23/selenium-grid/" itemprop="url">selenium-grid实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-23T21:02:56+08:00">
                2020-07-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、镜像分类</p>
<blockquote>
<p>hub 是集中管理节点，集中对外提供服务。node 是分布式的浏览器节点，受 hub 节点的控制。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用的镜像：</span><br><span class="line">selenium/hub:Selenium Grid Hub 节点</span><br><span class="line">selenium/node-chrome:安装有 Chrome 的 Selenium Node 节点镜像</span><br><span class="line">selenium/node-firefox:安装有 Firefox 的 Selenium Node 节点镜像</span><br><span class="line">selenium/node-chrome-debug: 安装有 Chrome 的 Selenium Node 节点镜像，包含远程桌面</span><br><span class="line">selenium/node-firefox-debug: 安装有 Firefox 的 Selenium Node 节点镜像，包含远程桌面</span><br></pre></td></tr></table></figure>
<p>2、使用场景</p>
<blockquote>
<p>解决重复执行测试,解决多浏览器兼容测试</p>
</blockquote>
<blockquote>
<p>分布式执行，减少测试运行时间</p>
</blockquote>
<p>3、安装部署</p>
<blockquote>
<p>docker方式安装</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker run -d -p 4444:4444 --name selenium-hub selenium/hub</span><br><span class="line"></span><br><span class="line">docker run -d --name node-chrome --link selenium-hub:hub selenium/node-chrome</span><br><span class="line"></span><br><span class="line">docker run -d --name node-firefox --link selenium-hub:hub selenium/node-firefox</span><br></pre></td></tr></table></figure>
<blockquote>
<p>docker-compose方式安装</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  selenium-hub:</span><br><span class="line">    image: selenium/hub</span><br><span class="line">    container_name: selenium-hub</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;4444:4444&quot;</span><br><span class="line"></span><br><span class="line">  chrome:</span><br><span class="line">    image: selenium/node-chrome</span><br><span class="line">    volumes:</span><br><span class="line">      - /dev/shm:/dev/shm</span><br><span class="line">    depends_on:</span><br><span class="line">      - selenium-hub</span><br><span class="line">    environment:</span><br><span class="line">      - HUB_HOST=selenium-hub</span><br><span class="line">    #ports:</span><br><span class="line">    #  - &quot;5900:5900&quot; # for VNC viewer</span><br><span class="line"></span><br><span class="line">  firefox:</span><br><span class="line">    image: selenium/node-firefox</span><br><span class="line">    volumes:</span><br><span class="line">      - /dev/shm:/dev/shm</span><br><span class="line">    depends_on:</span><br><span class="line">      - selenium-hub</span><br><span class="line">    environment:</span><br><span class="line">      - HUB_HOST=selenium-hub</span><br><span class="line"></span><br><span class="line"># 检查运行状态</span><br><span class="line">localhost% docker ps</span><br><span class="line">CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">6d4640a22a4f        selenium/node-firefox   &quot;/opt/bin/entry_poin…&quot;   15 minutes ago      Up 15 minutes                                 node-firefox</span><br><span class="line">ff2fe54541ea        selenium/node-chrome    &quot;/opt/bin/entry_poin…&quot;   16 minutes ago      Up 16 minutes                                 node-chrome</span><br><span class="line">18d02a1b37bd        selenium/hub            &quot;/opt/bin/entry_poin…&quot;   19 minutes ago      Up 19 minutes       0.0.0.0:4444-&gt;4444/tcp   selenium-hub</span><br></pre></td></tr></table></figure>
<p>4、运行测试脚本</p>
<blockquote>
<p>当部署带debug的浏览器镜像，通过主机ports暴露和vnc命令就可以打开浏览器进行调试<br>open vnc://:<a href="mailto:secret@192.168.1.100" target="_blank" rel="noopener">secret@192.168.1.100</a>:5900</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 脚本里通过browserName指定测试浏览器</span><br><span class="line"></span><br><span class="line">localhost% cat grid_demo.py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">driver = webdriver.Remote(</span><br><span class="line">command_executor=&apos;http://127.0.0.1:4444/wd/hub&apos;,</span><br><span class="line">desired_capabilities=&#123;&apos;browserName&apos;: &apos;chrome&apos;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">driver.get(&apos;https://www.baidu.com&apos;)</span><br><span class="line">print(&quot;get baidu&quot;)</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;hello selenium&quot;)</span><br><span class="line">driver.find_element_by_id(&quot;su&quot;).click()</span><br><span class="line"></span><br><span class="line">sleep(1)</span><br><span class="line"></span><br><span class="line">driver.get_screenshot_as_file(&quot;./baidu_img.png&quot;)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br><span class="line">print(&quot;end...&quot;)</span><br><span class="line"></span><br><span class="line">localhost% python grid_demo.py</span><br><span class="line">get baidu</span><br><span class="line">end...</span><br></pre></td></tr></table></figure>
<p>5、查看hub容器运行日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">localhost% docker logs -f 18d02a1b37bd</span><br><span class="line">2020-07-22 10:14:33,369 INFO Included extra file &quot;/etc/supervisor/conf.d/selenium-hub.conf&quot; during parsing</span><br><span class="line">2020-07-22 10:14:33,371 INFO supervisord started with pid 8</span><br><span class="line">2020-07-22 10:14:34,379 INFO spawned: &apos;selenium-hub&apos; with pid 11</span><br><span class="line">Starting Selenium Hub with configuration:</span><br><span class="line">2020-07-22 10:14:34,394 INFO success: selenium-hub entered RUNNING state, process has stayed up for &gt; than 0 seconds (startsecs)</span><br><span class="line">&#123;</span><br><span class="line">  &quot;host&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">  &quot;port&quot;: 4444,</span><br><span class="line">  &quot;role&quot;: &quot;hub&quot;,</span><br><span class="line">  &quot;maxSession&quot;: 5,</span><br><span class="line">  &quot;newSessionWaitTimeout&quot;: -1,</span><br><span class="line">  &quot;capabilityMatcher&quot;: &quot;org.openqa.grid.internal.utils.DefaultCapabilityMatcher&quot;,</span><br><span class="line">  &quot;throwOnCapabilityNotPresent&quot;: true,</span><br><span class="line">  &quot;jettyMaxThreads&quot;: -1,</span><br><span class="line">  &quot;cleanUpCycle&quot;: 5000,</span><br><span class="line">  &quot;browserTimeout&quot;: 0,</span><br><span class="line">  &quot;timeout&quot;: 1800,</span><br><span class="line">  &quot;debug&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">10:14:34.882 INFO [GridLauncherV3.parse] - Selenium server version: 3.141.59, revision: e82be7d358</span><br><span class="line">10:14:35.082 INFO [GridLauncherV3.lambda$buildLaunchers$5] - Launching Selenium Grid hub on port 4444</span><br><span class="line">2020-07-22 10:14:35.587:INFO::main: Logging initialized @1187ms to org.seleniumhq.jetty9.util.log.StdErrLog</span><br><span class="line">10:14:35.905 INFO [Hub.start] - Selenium Grid hub is up and running</span><br><span class="line">10:14:35.907 INFO [Hub.start] - Nodes should register to http://172.17.0.2:4444/grid/register/</span><br><span class="line">10:14:35.907 INFO [Hub.start] - Clients should connect to http://172.17.0.2:4444/wd/hub</span><br><span class="line">10:15:53.376 INFO [DefaultGridRegistry.add] - Registered a node http://172.17.0.3:5555</span><br><span class="line">10:17:20.131 INFO [DefaultRemoteProxy.onEvent] - Marking the node http://172.17.0.3:5555 as down: cannot reach the node for 2 tries</span><br><span class="line">10:17:23.039 INFO [DefaultGridRegistry.add] - Registered a node http://172.17.0.3:5555</span><br><span class="line">10:17:23.046 WARN [DefaultGridRegistry.removeIfPresent] - Cleaning up stale test sessions on the unregistered node http://172.17.0.3:5555</span><br><span class="line">10:18:28.156 INFO [DefaultGridRegistry.add] - Registered a node http://172.17.0.4:5555</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10:35:10.016 INFO [RequestHandler.process] - Got a request to create a new session: Capabilities &#123;browserName: firefox&#125;</span><br><span class="line">10:35:10.024 INFO [TestSlot.getNewSession] - Trying to create a new session on test slot &#123;server:CONFIG_UUID=77d8f1a3-4df1-417a-b274-e8e30d1e4de1, seleniumProtocol=WebDriver, browserName=firefox, maxInstances=1, moz:firefoxOptions=&#123;log=&#123;level=info&#125;&#125;, platformName=LINUX, version=68.0.1, applicationName=, platform=LINUX&#125;</span><br><span class="line"></span><br><span class="line">10:36:01.160 INFO [RequestHandler.process] - Got a request to create a new session: Capabilities &#123;browserName: chrome&#125;</span><br><span class="line">10:36:01.165 INFO [TestSlot.getNewSession] - Trying to create a new session on test slot &#123;server:CONFIG_UUID=5f3ba141-2be6-438a-91a3-fc5b4f60224a, seleniumProtocol=WebDriver, browserName=chrome, maxInstances=1, platformName=LINUX, version=76.0.3809.87, applicationName=, platform=LINUX&#125;</span><br></pre></td></tr></table></figure></p>
<p>6、node浏览器参数解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">browserTimeout: 0</span><br><span class="line"></span><br><span class="line">debug: false</span><br><span class="line"></span><br><span class="line">jettyMaxThreads: -1</span><br><span class="line"></span><br><span class="line">host: 172.17.0.3</span><br><span class="line"></span><br><span class="line">port: 5555</span><br><span class="line"></span><br><span class="line">role: node      # 表示启动的是node节点</span><br><span class="line"></span><br><span class="line">timeout: 1800</span><br><span class="line"></span><br><span class="line">cleanUpCycle: 5000</span><br><span class="line"></span><br><span class="line">maxSession: 1       # node节点最大会话请求</span><br><span class="line"></span><br><span class="line">capabilities: Capabilities &#123;applicationName: , browserName: chrome, maxInstances: 1, platform: LINUX, platformName: LINUX, seleniumProtocol: WebDriver, server:CONFIG_UUID: 5f3ba141-2be6-438a-91a3-fc5..., version: 76.0.3809.87&#125;</span><br><span class="line"></span><br><span class="line">downPollingLimit: 2</span><br><span class="line"></span><br><span class="line">hub: http://172.17.0.2:4444/grid/register   # 表示hub机地址</span><br><span class="line"></span><br><span class="line">id: http://172.17.0.3:5555</span><br><span class="line"></span><br><span class="line">nodePolling: 5000</span><br><span class="line"></span><br><span class="line">nodeStatusCheckTimeout: 5000</span><br><span class="line"></span><br><span class="line">proxy: org.openqa.grid.selenium.proxy.DefaultRemoteProxy</span><br><span class="line"></span><br><span class="line">register: true</span><br><span class="line"></span><br><span class="line">registerCycle: 5000</span><br><span class="line"></span><br><span class="line">remoteHost: http://172.17.0.3:5555</span><br><span class="line"></span><br><span class="line">unregisterIfStillDownAfter: 60000</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/30/git-worknote/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/30/git-worknote/" itemprop="url">git工作笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-30T21:02:56+08:00">
                2019-12-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="场景一：基于master快速切一个新分支，bugfix后提交到远端"><a href="#场景一：基于master快速切一个新分支，bugfix后提交到远端" class="headerlink" title="场景一：基于master快速切一个新分支，bugfix后提交到远端"></a>场景一：基于master快速切一个新分支，bugfix后提交到远端</h4><blockquote>
<p>创建新分支(同时切换到bugfix1)<br>代码提交<br>代码push至新分支</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Already up to date.</span><br><span class="line">localhost:bookstore liaoxb$ git checkout -b bugfix1</span><br><span class="line">Switched to a new branch &apos;bugfix1&apos;</span><br><span class="line">localhost:bookstore liaoxb$ echo &apos;bugfix test&apos; &gt; test.txt</span><br><span class="line">localhost:bookstore liaoxb$ git add .</span><br><span class="line">localhost:bookstore liaoxb$ git commit -m &quot;bugfix test&quot;</span><br><span class="line">[bugfix1 2eafe98] bugfix test</span><br><span class="line"> 1 file changed, 1 insertion(+), 3 deletions(-)</span><br><span class="line">localhost:bookstore liaoxb$ git push --set-upstream origin bugfix1</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 259 bytes | 259.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 1), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">remote: Create a pull request for &apos;bugfix1&apos; on Gitee by visiting:</span><br><span class="line">remote:     https://gitee.com/wisecloud/bookstore/pull/new/wisecloud:bugfix1...wisecloud:master</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line"> * [new branch]      bugfix1 -&gt; bugfix1</span><br><span class="line">Branch &apos;bugfix1&apos; set up to track remote branch &apos;bugfix1&apos; from &apos;origin&apos;.</span><br></pre></td></tr></table></figure>
<h4 id="场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干"><a href="#场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干" class="headerlink" title="场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干"></a>场景二：bugfix1分支上已提交的代码测试ok！需要合并回master主干</h4><blockquote>
<p>git checkout master<br>git merge bugfix1 (若遇到处理冲突，需要解决冲突后，重新提交)<br>git push</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git branch</span><br><span class="line">* bugfix1</span><br><span class="line">  master</span><br><span class="line">localhost:bookstore liaoxb$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/master&apos;.</span><br><span class="line">localhost:bookstore liaoxb$ git merge bugfix1</span><br><span class="line">Updating d369e85..2eafe98</span><br><span class="line">Fast-forward</span><br><span class="line"> test.txt | 4 +---</span><br><span class="line"> 1 file changed, 1 insertion(+), 3 deletions(-)</span><br><span class="line">localhost:bookstore liaoxb$ git push</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line">   d369e85..2eafe98  master -&gt; master</span><br></pre></td></tr></table></figure>
<h4 id="场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性"><a href="#场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性" class="headerlink" title="场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性"></a>场景三：某个分支独立开发了许多功能特性，但目前master只需要该分支的某个特性</h4><blockquote>
<p>git checkout cmft<br>git log检索目标commit id<br>git checkout master<br>git cherry-pick <commit id> (若遇到处理冲突，需要解决冲突后，重新提交)<br>git push</commit></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">localhost:wise2c-robot liaoxb$ git checkout cmft</span><br><span class="line">Already on &apos;cmft&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/cmft&apos;.</span><br><span class="line">localhost:wise2c-robot liaoxb$</span><br><span class="line">localhost:wise2c-robot liaoxb$ git log |grep efa8009d8ce0d9c6e3fb6bae3d2cfdd9f56ea7fd -C 4</span><br><span class="line">Date:   Fri Nov 15 16:44:20 2019 +0800</span><br><span class="line"></span><br><span class="line">    Merge branch &apos;cmft&apos; of gitee.com:wisecloud/wise2c-robot into cmft</span><br><span class="line"></span><br><span class="line">commit efa8009d8ce0d9c6e3fb6bae3d2cfdd9f56ea7fd</span><br><span class="line">Author: liaoxb &lt;1219199895@qq.com&gt;</span><br><span class="line">Date:   Fri Nov 15 16:41:16 2019 +0800</span><br><span class="line"></span><br><span class="line">    优化关键字Initialize Cluster&amp;完成ingress分组脚本</span><br><span class="line">localhost:wise2c-robot liaoxb$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/master&apos;.</span><br><span class="line">localhost:wise2c-robot liaoxb$</span><br><span class="line">localhost:wise2c-robot liaoxb$ git cherry-pick efa8009d8ce0d9c6e3fb6bae3d2cfdd9f56ea7fd</span><br><span class="line">error: could not apply efa8009... 优化关键字Initialize Cluster&amp;完成ingress分组脚本</span><br><span class="line">hint: after resolving the conflicts, mark the corrected paths</span><br><span class="line">hint: with &apos;git add &lt;paths&gt;&apos; or &apos;git rm &lt;paths&gt;&apos;</span><br><span class="line">hint: and commit the result with &apos;git commit&apos;</span><br></pre></td></tr></table></figure>
<h4 id="场景四：从本地和远端删除已经废弃了的bugfix1分支"><a href="#场景四：从本地和远端删除已经废弃了的bugfix1分支" class="headerlink" title="场景四：从本地和远端删除已经废弃了的bugfix1分支"></a>场景四：从本地和远端删除已经废弃了的bugfix1分支</h4><blockquote>
<p>git branch -r -d origin/branch-name<br>git push origin :branch-name<br>（一般情况下慎用）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git branch -r</span><br><span class="line">  origin/HEAD -&gt; origin/master</span><br><span class="line">  origin/bugfix1</span><br><span class="line">  origin/master</span><br><span class="line">localhost:bookstore liaoxb$ git branch -r -d origin/bugfix1</span><br><span class="line">Deleted remote-tracking branch origin/bugfix1 (was 2eafe98).</span><br><span class="line">localhost:bookstore liaoxb$ git push origin :bugfix1</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line"> - [deleted]         bugfix1</span><br><span class="line">localhost:bookstore liaoxb$ git branch -r</span><br><span class="line">  origin/HEAD -&gt; origin/master</span><br><span class="line">  origin/master</span><br></pre></td></tr></table></figure>
<h4 id="场景五：master分支引入了错误代码，需要回退至某次提交"><a href="#场景五：master分支引入了错误代码，需要回退至某次提交" class="headerlink" title="场景五：master分支引入了错误代码，需要回退至某次提交"></a>场景五：master分支引入了错误代码，需要回退至某次提交</h4><blockquote>
<p>git log检索需要回退的目标<commit id><br>git reset –hard <commit id><br>git push –force</commit></commit></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git reset d369e856336a93979f5b9292557f2c7d9b66080b</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M	test.txt</span><br><span class="line">ocalhost:bookstore liaoxb$ git push --force</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-3.0]</span><br><span class="line">To https://gitee.com/wisecloud/bookstore.git</span><br><span class="line"> + 2eafe98...d369e85 master -&gt; master (forced update)</span><br></pre></td></tr></table></figure>
<h4 id="场景六：git-pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码"><a href="#场景六：git-pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码" class="headerlink" title="场景六：git pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码"></a>场景六：git pull遇到本地修改和远端分支有代码冲突时，需要保留并合并代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">error: Your local changes to the following files would be overwritten by merge:</span><br><span class="line">	test.txt</span><br><span class="line">Please commit your changes or stash them before you merge.</span><br><span class="line">Aborting</span><br><span class="line">localhost:bookstore liaoxb$</span><br><span class="line">localhost:bookstore liaoxb$ echo &apos;local change test&apos; &gt; test.txt</span><br><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">error: Your local changes to the following files would be overwritten by merge:</span><br><span class="line">	test.txt</span><br><span class="line">Please commit your changes or stash them before you merge.</span><br><span class="line">Aborting</span><br></pre></td></tr></table></figure>
<blockquote>
<p>git stash 暂存本地的代码修改<br>git pull 拉取远端最新代码<br>git stash pop 合并暂存的本地代码，解决已冲突的文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git stash</span><br><span class="line">Saved working directory and index state WIP on master: d369e85 update</span><br><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">Fast-forward</span><br><span class="line"> test.txt | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">localhost:bookstore liaoxb$ git stash pop</span><br><span class="line">Auto-merging test.txt</span><br><span class="line">CONFLICT (content): Merge conflict in test.txt</span><br></pre></td></tr></table></figure>
<h4 id="场景七：git-pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码"><a href="#场景七：git-pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码" class="headerlink" title="场景七：git pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码"></a>场景七：git pull遇到本地修改和远端分支有代码冲突时，远端直接覆盖本地代码</h4><blockquote>
<p>git reset –hard 回滚到上个版本<br>git pull</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localhost:bookstore liaoxb$ git reset --hard</span><br><span class="line">HEAD is now at d369e85 update</span><br><span class="line">localhost:bookstore liaoxb$ git pull</span><br><span class="line">Updating d369e85..67e8e8a</span><br><span class="line">Fast-forward</span><br><span class="line"> test.txt | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/20/how_to_make_at/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/20/how_to_make_at/" itemprop="url">如何搭建自动化测试体系</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-20T23:02:56+08:00">
                2019-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自动化测试跟其它任何一种测试类型（比如异常测试、稳定性测试、性能测试等）都是类似的，它也是一种测试类型而已。在开展测试之前，我们首先必须要明确自动化测试的需求是什么，要解决什么样的问题。</p>
<h2 id="一、明确需求"><a href="#一、明确需求" class="headerlink" title="一、明确需求"></a>一、明确需求</h2><p>核心需求：“自动化”代替“手动”，提高测试效率</p>
<p>核心理念：</p>
<p>1、明确自动化收益。即每完成一条自动化用例，就减少了一条手工用例的执行时间。</p>
<p>2、每次回归或上线验证必须执行的用例优先自动化，让自动化收益最大化</p>
<p>3、确保新增用例是稳定100%通过前提下才被增加至用例集</p>
<p>4、自动化不可能完全代替手动</p>
<p>5、不要让环境问题成为瓶颈</p>
<h2 id="二、技术选型"><a href="#二、技术选型" class="headerlink" title="二、技术选型"></a>二、技术选型</h2><p>1、首先要分析项目的架构和状况</p>
<p>2、对于后端的服务，它如果是纯粹以接口的形式提供给其它组件去调用，那可以采取“接口自动化”</p>
<p>3、对于Web产品，如果前后端都在测试的保障范围，而且前端页面相对比较稳定，可以考虑采用“UI自动化”</p>
<p>4、最后测试技术栈选择python还是java，必须考虑团队成员的语言偏好和熟练程度</p>
<h2 id="三、自动化实施过程"><a href="#三、自动化实施过程" class="headerlink" title="三、自动化实施过程"></a>三、自动化实施过程</h2><h3 id="实施目标"><a href="#实施目标" class="headerlink" title="实施目标"></a>实施目标</h3><ul>
<li><p>同一份代码可以在多个集群执行</p>
</li>
<li><p>各个集群的测试数据相互独立，不会互相影响</p>
</li>
<li><p>可以方便地与数据库进行交互</p>
</li>
<li><p>当用例执行出错时，有详细的日志帮助定位</p>
</li>
<li><p>较好的可维护性和集群扩展性</p>
</li>
</ul>
<p>目前我跟的项目已经实现自动化的内容如下：</p>
<ul>
<li>基于接口的场景回归自动化测试</li>
<li>编译部署过程自动化</li>
<li>接入CICD平台跑自动化冒烟测试</li>
</ul>
<p>有计划未来要实现的自动化如下：</p>
<ul>
<li>接入CR平台（代码变更分析平台）的自动化</li>
<li>对外/上线打包发布的自动化</li>
</ul>
<h3 id="具体工作"><a href="#具体工作" class="headerlink" title="具体工作"></a>具体工作</h3><p>框架搭建时，主要用了以下工具：</p>
<ul>
<li>gitee：管理多分支代码</li>
<li>Robot Framework：作为测试框架</li>
<li>docker：打包测试脚本和python包依赖，构建测试镜像</li>
</ul>
<p>配置数据管理</p>
<ul>
<li><p>目前是把不同的测试集群信息放在wisecloud.yaml文件里管理，另外basedata.py文件管理其它配置数据。比如公共登录账号、harbor地址账号等。</p>
</li>
<li><p>配置读取：单独创建一个Rest类，并继承REST父类。get_baseurl实例方法会根据env_type变量值，去动态获取目标集群的访问地址、集群ip地址,并调用BuiltIn().set_global_variable方法去设为全局变量。供用例执行过程中使用</p>
</li>
</ul>
<p>分层设计与解耦</p>
<ul>
<li>用例、方法（关键字）、测试库分层</li>
<li>用例按模块划分成多个测试用例文件，集中放进测试套件Suites</li>
<li>方法按模块划分成多个资源文件，集中放进资源文件夹Resource</li>
<li>自定义创建测试库和方法，集中放进Library。以关键字的形式以供调用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">├── Library</span><br><span class="line">│   ├── Basedata.py</span><br><span class="line">│   ├── Rest.py</span><br><span class="line">│   ├── ServiceAdd.py</span><br><span class="line">│   └── wisecloud.yaml</span><br><span class="line">├── Resource</span><br><span class="line">│   ├── BackupRestore.robot</span><br><span class="line">│   ├── Common.robot</span><br><span class="line">│   ├── Configcenter.robot</span><br><span class="line">│   ├── Dashboard.robot</span><br><span class="line">│   ├── Monitor.robot</span><br><span class="line">│   ├── Orche_App.robot</span><br><span class="line">│   ├── Orche_Stack.robot</span><br><span class="line">│   ├── Resource_Manager.robot</span><br><span class="line">│   ├── Workflow.robot</span><br><span class="line">│   └── pipeline_workflow.robot</span><br><span class="line">├── Suites</span><br><span class="line">│   ├── backuprestore.robot</span><br><span class="line">│   ├── configcenter.robot</span><br><span class="line">│   ├── dashboard.robot</span><br><span class="line">│   ├── ingress</span><br><span class="line">│   │   └── ingress.robot</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="改进与提升"><a href="#改进与提升" class="headerlink" title="改进与提升"></a>改进与提升</h3><ul>
<li>用例并发执行，解决用例耗时问题</li>
<li>统一配置数据文件，放在资源文件夹里</li>
<li>单例模式，解决用例频繁依赖登录接口组装header的问题</li>
<li>解决一切脚本不稳定问题</li>
</ul>
<h2 id="四、自动化在研发阶段的应用"><a href="#四、自动化在研发阶段的应用" class="headerlink" title="四、自动化在研发阶段的应用"></a>四、自动化在研发阶段的应用</h2><h3 id="持续集成自动化测试"><a href="#持续集成自动化测试" class="headerlink" title="持续集成自动化测试"></a>持续集成自动化测试</h3><p>狭义的理解是每次开发提交代码，自动触发构建和测试。</p>
<p>但是在实际项目中并不是这样玩的，实际落地的CI测试可能是每日1次或者每周1次，这完全取决于产品形态和团队的研发流程而定。</p>
<h3 id="作为开发冒烟的一部分（未完成）"><a href="#作为开发冒烟的一部分（未完成）" class="headerlink" title="作为开发冒烟的一部分（未完成）"></a>作为开发冒烟的一部分（未完成）</h3><p>目前已经跟开发达成一致，开发非常欢迎将自动化用例接入到开发环境，用于他们每次变更时的环境正确性验证，可以尽早帮助他们发现研发过程中出现的问题。并且在提测前，只有100%通过自动化测试才可以进行提测。</p>
<h2 id="五、自动化在测试阶段的应用"><a href="#五、自动化在测试阶段的应用" class="headerlink" title="五、自动化在测试阶段的应用"></a>五、自动化在测试阶段的应用</h2><h3 id="版本提测后的自动化回归验收"><a href="#版本提测后的自动化回归验收" class="headerlink" title="版本提测后的自动化回归验收"></a>版本提测后的自动化回归验收</h3><p>在开发提测后，我会自动化地完成以下事情：</p>
<ul>
<li>流水线拉取测试代码</li>
<li>构建测试镜像</li>
<li>执行自动化测试</li>
<li>查看测试结果报告</li>
</ul>
<p>当自动化用例全部执行通过时，说明系统的核心功能回归没有问题，然后开始版本的细粒度功能的测试。</p>
<h3 id="版本Bug修复后的回归验收"><a href="#版本Bug修复后的回归验收" class="headerlink" title="版本Bug修复后的回归验收"></a>版本Bug修复后的回归验收</h3><p>在测试过程中，开发肯定会经常修复bug重新提交代码，每次有代码重新提交时，我都可以自动编译部署pr镜像。</p>
<h2 id="六、成效"><a href="#六、成效" class="headerlink" title="六、成效"></a>六、成效</h2><p>已实现的成效如下</p>
<ul>
<li><p>自动编译部署：测试过程中开发修复bug提交代码是非常频繁的，每次的手动编译部署可能都会耗费十几分钟，并且测试人员的关注点还不能离开。</p>
</li>
<li><p>自动化回归测试：以前一次回归测试，需要QA持续地投入超过30分钟。现在通过一键执行，程序会自动地执行，时间控制在5分钟以内。且QA可以将注意力放到其它事情上。</p>
</li>
</ul>
<p>正在计划、可预见的成效：</p>
<ul>
<li>自动打包发布：目前都是人工利用shell脚本retag&amp;push版本镜像到发布仓库中，还必须把注意力投入其中去检查是否有遗漏。计划利用流水线job去做好这件事</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/01/kubernetes-v1.16.4-deploy-by-kubeadm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/01/kubernetes-v1.16.4-deploy-by-kubeadm/" itemprop="url">使用kubeadm部署K8S集群v1.16.4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-01T22:00:56+08:00">
                2019-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="环境准备工作"><a href="#环境准备工作" class="headerlink" title="环境准备工作"></a>环境准备工作</h1><h2 id="环境角色"><a href="#环境角色" class="headerlink" title="环境角色"></a>环境角色</h2><table>
<thead>
<tr>
<th>IP</th>
<th>角色</th>
<th>软件安装 </th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.0.16</td>
<td>K8S Master</td>
<td>kube-apiserver kube-schduler kube-controller-manager kube-proxy docker flannel kubelet etcd</td>
</tr>
<tr>
<td>192.168.0.17</td>
<td>K8s Node</td>
<td>kubelet kube-proxy docker flannel</td>
</tr>
<tr>
<td>192.168.0.18</td>
<td>K8s Node</td>
<td>kubelet kube-proxy docker flannel</td>
</tr>
</tbody>
</table>
<blockquote>
<p>以下所有1.x操作,在三台节点都执行</p>
</blockquote>
<h2 id="统一设置主机名"><a href="#统一设置主机名" class="headerlink" title="统一设置主机名"></a>统一设置主机名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hostnamectl set-hostname test01</span><br><span class="line">$ hostnamectl set-hostname test02</span><br><span class="line">$ hostnamectl set-hostname test03</span><br></pre></td></tr></table></figure>
<h2 id="部署机免密登录到test01、test02、test03"><a href="#部署机免密登录到test01、test02、test03" class="headerlink" title="部署机免密登录到test01、test02、test03"></a>部署机免密登录到test01、test02、test03</h2><blockquote>
<p>前提是目标主机需要生成公钥以及密钥 ssh-keygen -t rsa</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@test02</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">The authenticity of host &apos;test02 (192.168.0.17)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:Omg7RAlyXPvDcwNyJdufEmAMHnwcS3eh/gsaHPZVP6I.</span><br><span class="line">ECDSA key fingerprint is MD5:5d:55:0f:b2:75:4d:39:ee:47:c1:a8:3f:0f:12:96:30.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@test02&apos;s password:</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &apos;root@test02&apos;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/12/01/kubernetes-v1.16.4-deploy-by-kubeadm/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/29/jenkins-ci-apitest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/29/jenkins-ci-apitest/" itemprop="url">使用Jenkins实现持续集成API自动化测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-29T22:13:44+08:00">
                2019-03-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><p>1、公司内部成功搭建了一套CICD，可以定时和自动化构建部署最新的产品版本，需要对接每日自动化测试<br>2、Jenkins有着其丰富的插件和job触发机制，易于拓展，能够满足持续测试的大部分场景，尤其是jenkins pipeline使得创建任务非常灵活和简洁，最终选择jenkins作为持续集成测试平台</p>
<h1 id="安装和配置Jenkins"><a href="#安装和配置Jenkins" class="headerlink" title="安装和配置Jenkins"></a>安装和配置Jenkins</h1><h2 id="jenkins容器安装"><a href="#jenkins容器安装" class="headerlink" title="jenkins容器安装"></a>jenkins容器安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在docker主机上执行命令：</span><br><span class="line">docker run -u root -d  --name jenkins-ci -p 8081:8080 -p 50000:50000 -v /etc/localtime:/etc/localtime -v /etc/timezone:/etc/timezone -v jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock  jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-v /etc/timezone:/etc/timezone 这个是用于修改jenkins时区的<br>如果宿主机不存在timezone文件，自己手动创建并写入Asia/Shanghai即可。<br>docker run参数的具体说明请看官方文档，介绍得很详细。<a href="https://jenkins.io/zh/doc/book/installing/" target="_blank" rel="noopener">https://jenkins.io/zh/doc/book/installing/</a></p>
</blockquote>
<p>执行命令截图：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk01.png?raw=true" alt="jk.png"></p>
<p>为了省心方便，在此默认选择了jenkins推荐的插件安装,这需要耐心等待一段时间：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk02.png?raw=true" alt="jk.png"></p>
<h2 id="配置邮件通知"><a href="#配置邮件通知" class="headerlink" title="配置邮件通知"></a>配置邮件通知</h2><blockquote>
<p>这里特别注意的是密码应该填qq邮箱的授权码，填写完毕测试一下邮件发送成功即可<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk03.png?raw=true" alt="jk.png"></p>
</blockquote>
<h2 id="安装插件robot-framework"><a href="#安装插件robot-framework" class="headerlink" title="安装插件robot-framework"></a>安装插件robot-framework</h2><blockquote>
<p>由于项目里的自动化脚本基于RF编写开发，所以Jenkins需要安装这个插件。该插件在Jenkins中收集并发布Robot Framework测试结果。<br>至此，jenkins的基本配置工作就算完了，接下来最核心就是编写pipeline脚本。</p>
</blockquote>
<h1 id="编写Pipeline脚本"><a href="#编写Pipeline脚本" class="headerlink" title="编写Pipeline脚本"></a>编写Pipeline脚本</h1><p>直接贴脚本，pipeline支持的语法请查看官方手册。</p>
<p>pipeline流程图：</p>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk09.png?raw=true" alt="jk.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    options &#123;</span><br><span class="line">        // 添加日志打印时间</span><br><span class="line">        timestamps()</span><br><span class="line">        // 设置全局超时间</span><br><span class="line">        // timeout(time:10,unit:&apos;MINUTES&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123;</span><br><span class="line">        // GIT_BRANCH = &apos;master&apos; # 已设置全局变量</span><br><span class="line">        GIT_USER_ID = &apos;76f84542-2dba-4128-8651-bed7a849eddd&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;Git Clone&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                // sh  &apos;printenv |sort&apos;</span><br><span class="line">                git branch: &quot;$&#123;GIT_BRANCH&#125;&quot;, credentialsId: &quot;$&#123;GIT_USER_ID&#125;&quot;, url: &apos;https://gitee.com/wisecloud/wise2c-robot.git&apos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&apos;Build Image&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &apos;docker build -t $&#123;JOB_NAME&#125;:$&#123;GIT_BRANCH&#125; .&apos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&apos;API Test&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script&#123;</span><br><span class="line">                    sh &apos;ls -a&apos;</span><br><span class="line">                    sh &apos;docker run --rm -v jenkins-data:/robot-results --name $&#123;JOB_NAME&#125; $&#123;JOB_NAME&#125;:$&#123;GIT_BRANCH&#125; robot --outputdir /robot-results /wise2c-robot/Project/Suites/resource_manager.robot&apos;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            echo &apos;Publish Test Report&apos;</span><br><span class="line">            robot logFileName: &apos;log.html&apos;, outputFileName: &apos;output.xml&apos;, outputPath: &apos;/var/jenkins_home/&apos;, passThreshold: 100.0, reportFileName: &apos;report.html&apos;, unstableThreshold: 90.0</span><br><span class="line">            // deleteDir() /* clean up our workspace */</span><br><span class="line">        &#125;</span><br><span class="line">        success &#123;</span><br><span class="line">            mail bcc: &apos;&apos;, body: &quot;API自动化测试通过\n测试版本分支：$&#123;GIT_BRANCH&#125;\n测试报告地址：$&#123;BUILD_URL&#125;&quot;, cc: &apos;&apos;, from: &apos;1219199895@qq.com&apos;, replyTo: &apos;&apos;, subject: &quot;$&#123;JOB_NAME&#125;测试报告&quot;, to: &apos;liaoxb@wise2c.com&apos;</span><br><span class="line">        &#125;</span><br><span class="line">        failure &#123;</span><br><span class="line">            mail bcc: &apos;&apos;, body: &quot;API自动化测试未通过，请相关模块的同事分析定位问题，谢谢大家。\n测试版本分支：$&#123;GIT_BRANCH&#125;\n测试报告地址：$&#123;BUILD_URL&#125;&quot;, cc: &apos;&apos;, from: &apos;1219199895@qq.com&apos;, replyTo: &apos;&apos;, subject: &quot;$&#123;JOB_NAME&#125;测试报告&quot;, to: &apos;liaoxb@wise2c.com&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="webhook自动触发Jenkins-pipeline"><a href="#webhook自动触发Jenkins-pipeline" class="headerlink" title="webhook自动触发Jenkins pipeline"></a>webhook自动触发Jenkins pipeline</h1><p>1、新建pipeline时，构建触发器选择‘触发远程构建’这项，输入token name。比如apitest<br>这时就可以获得一个webhhok地址，提供给维护CICD平台的同事即可。<br>2、把pipeline脚本内容粘贴到流水线里，检查下有没有语法错误，最后点击保存<br>3、现在可以用curl模拟发送一次webhhok请求，不过记得临时把全局安全配置里的授权策略给放开，改成没有任何限制。</p>
<blockquote>
<p>curl JENKINS_URL/job/wise2c-robot/build?token=TOKEN_NAME<br>从控制台输出日志可以看到触发原因：</p>
</blockquote>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk05.png?raw=true" alt="jk.png"></p>
<h1 id="测试结果报告展示"><a href="#测试结果报告展示" class="headerlink" title="测试结果报告展示"></a>测试结果报告展示</h1><blockquote>
<p>job首页测试结果展示，失败了1条case，同时收到了一封关于api测试失败的邮件通知：</p>
</blockquote>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk04.png?raw=true" alt="jk.png"><br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk07.png?raw=true" alt="jk.png"></p>
<blockquote>
<p>测试结果详情页面展示，点击log.html链接可以直接查看日志；</p>
</blockquote>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk06.png?raw=true" alt="jk.png"><br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/jenkins/jk08.png?raw=true" alt="jk.png"></p>
<p>注：如果到打开失败，可以参考这个解决办法。<a href="https://stackoverflow.com/questions/36607394/error-opening-robot-framework-log-failed" target="_blank" rel="noopener">https://stackoverflow.com/questions/36607394/error-opening-robot-framework-log-failed</a><br>管理jenkins–&gt;脚本命令行输入如下脚本:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(&quot;hudson.model.DirectoryBrowserSupport.CSP&quot;,&quot;sandbox allow-scripts; default-src &apos;none&apos;; img-src &apos;self&apos; data: ; style-src &apos;self&apos; &apos;unsafe-inline&apos; data: ; script-src &apos;self&apos; &apos;unsafe-inline&apos; &apos;unsafe-eval&apos; ;&quot;)</span><br></pre></td></tr></table></figure></p>
<h1 id="持续改进"><a href="#持续改进" class="headerlink" title="持续改进"></a>持续改进</h1><p>1、目前创建的wise2c-robot任务脚本数量500+，全部跑完至少需要2个小时，后期打算按模块拆分成多个子任务job，并行执行测试。</p>
<p>2、邮件通知的正文内容过于简单，希望能把每条case的执行结果直接展示出来</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/04/kubernetes-monitoring-by-prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/04/kubernetes-monitoring-by-prometheus/" itemprop="url">Kubernetes集群监控</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T23:00:56+08:00">
                2019-03-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在实际工作中，通过prometheus监控的主要对象有如下几个：</p>
<ul>
<li>基础设施层：主要是监控k8s节点资源，如CPU,内存,网络吞吐和带宽占用,磁盘I/O和磁盘使用等指标；</li>
<li>中间件层：监控产品使用到的中间件（一般会独立部署在外部集群），主要有consul、mysql、nats、redis、haproxy</li>
<li>Kubernetes集群：监控Kubernetes集群本身的关键指标</li>
<li>Kubernetes集群上部署的应用：监控部署在Kubernetes集群上的应用（pod或container等）</li>
</ul>
<p>Step By Step，部署工作正式开始！<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/03/04/kubernetes-monitoring-by-prometheus/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </p></div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/24/nginx-worknote-proxy-for-monitor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/24/nginx-worknote-proxy-for-monitor/" itemprop="url">nginx工作笔记：配置反向代理访问监控系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-24T22:33:44+08:00">
                2019-01-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><p>1、测试环境部署了一套监控系统，测试人员经常需要访问web去分析数据或定位问题，但是访问不方便也不灵活,每次需要去找到pod运行主机IP和svc暴露的端口。<br>2、通过利用nginx反向代理+负载均衡配置，快速地访问系统。比如prometheus、granfana等</p>
<h1 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h1><p>1、查看测试集群监控服务的pod和svc信息，prometheus和grafana均以NodePort的形式映射到主机端口。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|kubernetes-admin@q4-default# kcc get po,svc |grep grafana</span><br><span class="line">pod/grafana-6c5f687b5b-79qf8                         1/1       Running     0          56m</span><br><span class="line"></span><br><span class="line">service/grafana                         NodePort    10.104.106.121   &lt;none&gt;        3000:31962/TCP      12d</span><br><span class="line">|kubernetes-admin@q4-default# kca get po,svc |grep prometheus</span><br><span class="line">pod/prometheus-68d7459bb-cmnmn                  5/5       Running   0          2d</span><br><span class="line"></span><br><span class="line">service/prometheus                 NodePort    10.99.169.156   &lt;none&gt;        81:32001/TCP,9093:32003/TCP   2d</span><br></pre></td></tr></table></figure></p>
<p>这时是可以通过集群内主机内网ip+端口，成功访问到监控系统。比如访问prometheus端口32001<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor nginx-proxy]# curl 192.168.0.34:32001</span><br><span class="line">&lt;a href=&quot;/graph&quot;&gt;Found&lt;/a&gt;.</span><br><span class="line"></span><br><span class="line">[root@harbor nginx-proxy]# curl 192.168.0.35:32001</span><br><span class="line">&lt;a href=&quot;/graph&quot;&gt;Found&lt;/a&gt;.</span><br><span class="line"></span><br><span class="line">[root@harbor nginx-proxy]# curl 192.168.0.36:32001</span><br><span class="line">&lt;a href=&quot;/graph&quot;&gt;Found&lt;/a&gt;.</span><br></pre></td></tr></table></figure></p>
<p>2、nginx配置文件如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor nginx-proxy]# cat default.conf</span><br><span class="line">    # 设定实际的后端服务器列表</span><br><span class="line">    upstream prometheus_server&#123;</span><br><span class="line">	    #设定负载均衡的服务器列表，weigth参数表示权值（缺省是1），权值越高被分配到的几率越大</span><br><span class="line">        server 192.168.0.34:32001 weight=1;</span><br><span class="line">        server 192.168.0.35:32001 weight=2;</span><br><span class="line">        server 192.168.0.36:32001 weight=3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream alert_server&#123;</span><br><span class="line">        server 192.168.0.34:32003;</span><br><span class="line">        server 192.168.0.35:32003;</span><br><span class="line">        server 192.168.0.36:32003;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream grafana_server&#123;</span><br><span class="line">        server  192.168.0.34:31962;</span><br><span class="line">        #server 192.168.0.35:31962;</span><br><span class="line">        #server 192.168.0.36:31962;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        #监听80端口，用于HTTP协议</span><br><span class="line">        listen       80;</span><br><span class="line">        #定义使用www.test.com访问</span><br><span class="line">        server_name  www.test.com;</span><br><span class="line">        proxy_headers_hash_max_size     51200;</span><br><span class="line">        proxy_headers_hash_bucket_size  6400;</span><br><span class="line">        proxy_set_header                Host             $host;</span><br><span class="line">        proxy_set_header                X-Real-IP        $remote_addr;</span><br><span class="line">        proxy_set_header                X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">        #location / &#123;</span><br><span class="line">        #    root /usr/share/nginx/html;</span><br><span class="line">        #    index index.html;</span><br><span class="line">        #&#125;</span><br><span class="line">        #反向代理的路径</span><br><span class="line">        location / &#123;</span><br><span class="line">            #请求将转向upstream里prometheus_server定义的服务器列表</span><br><span class="line">            proxy_pass  http://prometheus_server/;</span><br><span class="line">            #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">            proxy_connect_timeout     30s;</span><br><span class="line">        &#125;</span><br><span class="line">        location /alert/ &#123;</span><br><span class="line">            proxy_pass  http://alert_server/;</span><br><span class="line">            proxy_connect_timeout     30s;</span><br><span class="line">        &#125;</span><br><span class="line">        location /grafana/ &#123;</span><br><span class="line">            proxy_pass  http://grafana_server/;</span><br><span class="line">            proxy_connect_timeout     30s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>3、make run快速启动nginx容器<br>Makefile里总共三步操作：<br>快速启动nginx容器，映射到主机端口8081，<br>拷贝default.conf到nginx容器/etc/nginx/conf.d/目录<br>重启nginx容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor nginx-proxy]# ll</span><br><span class="line">总用量 12</span><br><span class="line">-rw-r--r-- 1 root root 1587 1月  24 21:39 default_backup.conf</span><br><span class="line">-rw-r--r-- 1 root root 1327 1月  24 21:40 default.conf</span><br><span class="line">-rw-r--r-- 1 root root  353 1月  24 21:44 Makefile</span><br><span class="line">[root@harbor nginx-proxy]# make run</span><br><span class="line">docker rm -f nginx-web</span><br><span class="line">nginx-web</span><br><span class="line">docker run -d -p 8081:80 --name nginx-web nginx</span><br><span class="line">229484284a78d84800527337eb7a074d42ff62987cb8e479a0d6c4c65b586156</span><br><span class="line">docker cp default.conf nginx-web:/etc/nginx/conf.d/</span><br><span class="line">docker restart nginx-web</span><br><span class="line">nginx-web</span><br><span class="line">[root@harbor nginx-proxy]# docker ps |grep nginx-web</span><br><span class="line">229484284a78        nginx                                                                 &quot;nginx -g &apos;daemon ...&quot;   30 seconds ago      Up 29 seconds          0.0.0.0:8081-&gt;80/tcp                                               nginx-web</span><br></pre></td></tr></table></figure>
<p>4、在浏览器中访问 <a href="http://www.test.com，这时应该就可以根据location，访问到不同的服务了。" target="_blank" rel="noopener">www.test.com，这时应该就可以根据location，访问到不同的服务了。</a><br>访问Grafana Dashboard：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx15.png?raw=true" alt="7.png"><br>访问Alertmanager ui：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx16.png?raw=true" alt="7.png"><br>访问:Prometheus ui<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx17.png?raw=true" alt="7.png"></p>
<h1 id="关于负载均衡策略"><a href="#关于负载均衡策略" class="headerlink" title="关于负载均衡策略"></a>关于负载均衡策略</h1><p>Nginx提供了多种负载均衡策略，在上面其实已用到过轮询算法。在这里延伸多了解一下其它策略。</p>
<h2 id="轮询"><a href="#轮询" class="headerlink" title="轮询"></a>轮询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  # 默认所有服务器权重为 1</span><br><span class="line">  server 192.168.250.220:8080</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="加权轮询"><a href="#加权轮询" class="headerlink" title="加权轮询"></a>加权轮询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  server 192.168.250.220:8080  weight=3</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最少连接"><a href="#最少连接" class="headerlink" title="最少连接"></a>最少连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  least_conn;</span><br><span class="line">  server 192.168.250.220:8080</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="IP-Hash"><a href="#IP-Hash" class="headerlink" title="IP Hash"></a>IP Hash</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream bck_testing_01 &#123;</span><br><span class="line">  ip_hash;</span><br><span class="line">  server 192.168.250.220:8080</span><br><span class="line">  server 192.168.250.221:8080</span><br><span class="line">  server 192.168.250.222:8080</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考文档：<br><a href="https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html" target="_blank" rel="noopener">https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html</a><br><a href="https://mp.weixin.qq.com/s/qMtJtZ6g62wibRVilIHPNg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/qMtJtZ6g62wibRVilIHPNg</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/17/nginx-worknote-setup-static-web/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/17/nginx-worknote-setup-static-web/" itemprop="url">Nginx工作笔记：搭建一个归档日志的静态文件服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-17T20:00:56+08:00">
                2019-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>上次了解到nginx相关基础知识，这次就趁热打铁，学习亲手搭建一个静态资源的文件服务器。其中会涉及到gzip功能的配置。</p>
<h1 id="搭建目标"><a href="#搭建目标" class="headerlink" title="搭建目标"></a>搭建目标</h1><p>1、可以成功访问一些静态资源文件（图片、日志文件html等）<br>2、服务器会以gzip压缩的形式返回数据</p>
<h1 id="搭建步骤"><a href="#搭建步骤" class="headerlink" title="搭建步骤"></a>搭建步骤</h1><h2 id="容器运行nginx，端口映射到本机8080"><a href="#容器运行nginx，端口映射到本机8080" class="headerlink" title="容器运行nginx，端口映射到本机8080"></a>容器运行nginx，端口映射到本机8080</h2><p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx6.png?raw=true" alt="6.png"></p>
<h2 id="查看静态资源文件和nginx-conf"><a href="#查看静态资源文件和nginx-conf" class="headerlink" title="查看静态资源文件和nginx.conf"></a>查看静态资源文件和nginx.conf</h2><p>本地机器上，静态资源全部放在static-web目录下。<br>子目录img存放的是图片jpg、png，子目录robot-log存放的是每天归档的测试日志报告html。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">localhost:nginx-test liaoxb$ tree</span><br><span class="line">.</span><br><span class="line">├── nginx.conf</span><br><span class="line">└── static-web</span><br><span class="line">    ├── img</span><br><span class="line">    │   ├── test01.jpg</span><br><span class="line">    │   └── test02.png</span><br><span class="line">    └── robot-log</span><br><span class="line">        ├── 2019-01-16</span><br><span class="line">        │   ├── log.html</span><br><span class="line">        │   ├── output.xml</span><br><span class="line">        │   └── report.html</span><br><span class="line">        └── 2019-01-17</span><br><span class="line">            ├── log.html</span><br><span class="line">            ├── output.xml</span><br><span class="line">            └── report.html</span><br></pre></td></tr></table></figure></p>
<p>相比nginx容器内的默认配置文件，本地对nginx.conf做了如下改动(重要)：<br>1、开启了gzip功能，并配置了相关参数（后面会详细介绍参数）<br>2、server块里追加了两个location块（/img/、/robot-log/），将对应请求路由到root所指向的目录或index文件<br>3、修改了server_name，记得在本地主机/etc/hosts文件下写入static.web.com<br>4、注释了include参数，不过根目录依然是可以访问到nginx默认欢迎页面的。</p>
<p>完整配置内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    gzip              on;</span><br><span class="line">    gzip_min_length   1k;</span><br><span class="line">    gzip_buffers      4 16k;</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_comp_level   3;</span><br><span class="line">    gzip_types        text/plain application/x-javascript text/css application/xml text/javascript application/javascript image/jpeg image/jpg image/png;</span><br><span class="line">    gzip_proxied      any;</span><br><span class="line">    gzip_vary         on;</span><br><span class="line">    gzip_disable      &quot;MSIE [1-6]\.&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  static.web.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root /usr/share/nginx/html;</span><br><span class="line">            index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        location /img/ &#123;</span><br><span class="line">            root /usr/share/static-web;</span><br><span class="line">            autoindex on;</span><br><span class="line">        &#125;</span><br><span class="line">        location /robot-log/ &#123;</span><br><span class="line">            root /usr/share/static-web;</span><br><span class="line">            autoindex on;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="动态配置nginx容器"><a href="#动态配置nginx容器" class="headerlink" title="动态配置nginx容器"></a>动态配置nginx容器</h2><p>动态配置nginx容器，需执行以下三步操作：<br>1、替换容器内的/etc/nginx/nginx.conf<br>2、拷贝静态资源目录static-web到指定的容器目录/usr/share/<br>3、重启nginx容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">localhost:nginx-test liaoxb$ ll</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x   4 liaoxb  staff   128  3  2 22:56 ./</span><br><span class="line">drwxr-xr-x  10 liaoxb  staff   320  3  1 23:28 ../</span><br><span class="line">-rw-r--r--@  1 liaoxb  staff  1404  1 16  2019 nginx.conf</span><br><span class="line">drwxr-xr-x   5 liaoxb  staff   160  1 16  2019 static-web/</span><br><span class="line">localhost:nginx-test liaoxb$ docker cp nginx.conf nginx-test:/etc/nginx/</span><br><span class="line">localhost:nginx-test liaoxb$ docker cp static-web nginx-test:/usr/share/</span><br><span class="line">localhost:nginx-test liaoxb$ docker restart nginx-test</span><br><span class="line">nginx-test</span><br><span class="line">localhost:nginx-test liaoxb$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">addfae34988b        nginx               &quot;nginx -g &apos;daemon of…&quot;   About an hour ago   Up 7 seconds        0.0.0.0:8080-&gt;80/tcp   nginx-test</span><br></pre></td></tr></table></figure>
<h1 id="访问静态资源"><a href="#访问静态资源" class="headerlink" title="访问静态资源"></a>访问静态资源</h1><p>1、域名:8080访问根目录，成功访问nginx默认web页面<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx8.png?raw=true" alt="8.png"><br>2、域名:8080访问/img/，成功访问目录下的所有图片<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx9.png?raw=true" alt="9.png"><br>3、域名:8080访问/robot-log/，成功访问目录下的归档日志<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx10.png?raw=true" alt="10.png"><br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx11.png?raw=true" alt="11.png"></p>
<h2 id="gzip配置详解"><a href="#gzip配置详解" class="headerlink" title="gzip配置详解"></a>gzip配置详解</h2><blockquote>
<p>Nginx实现资源压缩的原理是通过ngx_http_gzip_module模块拦截请求，并对需要做gzip的类型做gzip，ngx_http_gzip_module是Nginx默认集成的，不需要重新编译，直接开启即可。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 开启gzip</span><br><span class="line">gzip              on;</span><br><span class="line"># 启用gzip压缩的最小文件，小于设置值的文件将不会压缩</span><br><span class="line">gzip_min_length   1k;</span><br><span class="line"># 设置压缩所需要的缓冲区大小</span><br><span class="line">gzip_buffers      4 16k;</span><br><span class="line"># 设置gzip压缩针对的HTTP协议版本</span><br><span class="line">gzip_http_version 1.1;</span><br><span class="line"># gzip 压缩级别，1-9，数字越大压缩的越好，也越占用CPU时间，后面会有详细说明</span><br><span class="line">gzip_comp_level   3;</span><br><span class="line"># 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到</span><br><span class="line">gzip_types        text/plain application/x-javascript text/css application/xml text/javascript application/javascript image/jpeg image/jpg image/png;</span><br><span class="line">gzip_proxied      any;</span><br><span class="line"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span><br><span class="line">gzip_vary         on;</span><br><span class="line"># 禁用IE 6 gzip</span><br><span class="line">gzip_disable      &quot;MSIE [1-6]\.&quot;;</span><br></pre></td></tr></table></figure>
<h2 id="压缩效果对比"><a href="#压缩效果对比" class="headerlink" title="压缩效果对比"></a>压缩效果对比</h2><p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx14.png?raw=true" alt="14.png"><br>curl命令直接对比查看：</p>
<p>第一次curl请求头未带’Accept-Encoding: gzip,deflate’时，服务器不会压缩，直接返回html，从Content-Length也可以看出report.html的size是233340，也就是228kb大小。</p>
<p>第二次curl请求头带了’Accept-Encoding: gzip,deflate’时，服务器则会进行压缩数据后再返回content，同时response字段也会出现Content-Encoding: gzip，这就证明gzip压缩配置生效了。不过这次的response看不见Content-Length，怎么确定压缩成多少了呢？</p>
<p>这也很容易，结合着浏览器访问同个web页面查看size就清楚了，压缩后是77.1kb。<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx12.png?raw=true" alt="12.png"></p>
<p>参考文档：<br><a href="https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html" target="_blank" rel="noopener">https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/10/nginx-worknote-introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/10/nginx-worknote-introduction/" itemprop="url">Nginx工作笔记：入门基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T20:00:56+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Nginx常用功能"><a href="#Nginx常用功能" class="headerlink" title="Nginx常用功能"></a>Nginx常用功能</h1><h2 id="http正向代理"><a href="#http正向代理" class="headerlink" title="http正向代理"></a>http正向代理</h2><p>正向代理是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。<br>当然前提是客户端要知道正向代理服务器的 IP 地址，还有代理程序的端口。</p>
<p>正向代理的用途：<br>（1）访问原来无法访问的资源，如google<br>（2） 可以做缓存，加速访问资源<br>（3）对客户端访问授权，上网进行认证<br>（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息</p>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx1.png?raw=true" alt="1.png"></p>
<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。<br>反向代理的作用：<br>（1）保证内网的安全，可以使用反向代理提供WAF功能，阻止web攻击<br>（2）负载均衡，通过反向代理服务器来优化网站的负载<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx2.png?raw=true" alt="2.png"><br>两者区别，看图说话：<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx3.png?raw=true" alt="3.png"></p>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><h3 id="基本概念："><a href="#基本概念：" class="headerlink" title="基本概念："></a>基本概念：</h3><p>这里提到的客户端发送的、Nginx 反向代理服务器接收到的请求数量，就是我们说的负载量。<br>请求数量按照一定的规则进行分发，到不同的服务器处理的规则，就是一种均衡规则。<br>所以将服务器接收到的请求按照规则分发的过程，称为负载均衡。</p>
<h3 id="nginx负载均衡算法"><a href="#nginx负载均衡算法" class="headerlink" title="nginx负载均衡算法"></a>nginx负载均衡算法</h3><p>Nginx提供的负载均衡策略有2种：内置策略和扩展策略。内置策略为轮询，加权轮询，Ip hash。<br>扩展策略，就天马行空，只有你想不到的没有他做不到的啦，你可以参照所有的负载均衡算法，给他一一找出来做下实现。<br>上2个图，理解这三种负载均衡算法的实现<br><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx4.png?raw=true" alt="4.png"></p>
<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/master/img/linux/nginx5.png?raw=true" alt="5.png"><br>Ip hash算法，对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。</p>
<h1 id="Nginx配置文件详解"><a href="#Nginx配置文件详解" class="headerlink" title="Nginx配置文件详解"></a>Nginx配置文件详解</h1><p>Nginx配置文件主要分成四部分：main（全局设置）、server（主机设置）、upstream（上游服务器设置，主要为反向代理、负载均衡相关配置）和location（URL匹配特定位置后的设置），每部分包含若干个指令。</p>
<p>他们之间的关系式：server继承main，location继承server；upstream既不会继承指令也不会被继承。它有自己的特殊指令，不需要在其他地方的应用</p>
<p>main部分设置的指令将影响其它所有部分的设置；server部分的指令主要用于指定虚拟主机域名、IP和端口；upstream的指令用于设置一系列的后端服务器，设置反向代理及后端服务器的负载均衡；location部分用于匹配网页位置（比如，根目录”/“,”/images”,等等）。</p>
<blockquote>
<p>docker run –name nginx-test -p 8080:80 -d nginx<br>使用docker命令直接安装启动nginx</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 进入容器内查看默认的配置文件,均在/etc/nginx/路径下。</span><br><span class="line">localhost:~ liaoxb$ docker exec -ti 2ccbf7fa358e sh</span><br><span class="line"># find / -name nginx.conf</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line"># find / -name default.conf</span><br><span class="line">/etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure>
<p>默认的 nginx 配置文件 nginx.conf 内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@2ccbf7fa358e:/# cat /etc/nginx/nginx.conf</span><br><span class="line">user  nginx;    #定义Nginx运行的用户和用户组</span><br><span class="line"></span><br><span class="line">worker_processes  1;    #nginx进程数，建议设置为等于CPU总核心数</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;   #全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span><br><span class="line"></span><br><span class="line">pid        /var/run/nginx.pid;  #进程pid文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;       #单个进程最大连接数（最大连接数=连接数*进程数）</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#设定http服务器，利用它的反向代理功能提供负载均衡支持</span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;        #文件扩展名与文件类型映射表</span><br><span class="line">    default_type  application/octet-stream;     #默认文件类型</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line">    </span><br><span class="line">#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span><br><span class="line">    sendfile        on;</span><br><span class="line">#此选项允许或禁止使用socke的TCP_CORK的选项，此选项仅在使用sendfile的时候使用</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;      #长连接超时时间，单位是秒</span><br><span class="line"></span><br><span class="line">    #gzip  on;      #gzip模块设置</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;   #增加nginx虚拟主机配置文件(conf.d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>默认的nginx虚拟主机配置文件如下（反向代理到nginx的默认html页面，位于/usr/share/nginx/html/index.html）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@2ccbf7fa358e:/# cat /etc/nginx/conf.d/default.conf</span><br><span class="line">#虚拟主机的配置</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;    #监听端口</span><br><span class="line">    server_name  localhost;     #域名可以有多个，用空格隔开</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line">#对 &quot;/&quot; 启用反向代理</span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;   #根目录</span><br><span class="line">        index  index.html index.htm;    #设置默认页</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    proxy_pass   http://127.0.0.1;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    root           html;</span><br><span class="line">    #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    #    fastcgi_index  index.php;</span><br><span class="line">    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">    #    include        fastcgi_params;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # deny access to .htaccess files, if Apache&apos;s document root</span><br><span class="line">    # concurs with nginx&apos;s one</span><br><span class="line">    #</span><br><span class="line">    #location ~ /\.ht &#123;</span><br><span class="line">    #    deny  all;     #拒绝的ip</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>参考文档：<br><a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html" target="_blank" rel="noopener">https://www.runoob.com/w3cnote/nginx-setup-intro.html</a><br><a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html" target="_blank" rel="noopener">https://www.runoob.com/w3cnote/nginx-setup-intro.html</a><br><a href="https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html" target="_blank" rel="noopener">https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/20/analysis-of-the-performance-test-key-metrics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liaoxb">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liaoxb's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/20/analysis-of-the-performance-test-key-metrics/" itemprop="url">解读性能测试的几个重要指标</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-20T00:00:55+08:00">
                2018-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="性能测试常用衡量指标"><a href="#性能测试常用衡量指标" class="headerlink" title="性能测试常用衡量指标"></a>性能测试常用衡量指标</h1><h2 id="并发用户数"><a href="#并发用户数" class="headerlink" title="并发用户数"></a>并发用户数</h2><ul>
<li><strong>业务层面的并发用户数</strong>，指的是实际使用系统的用户总数。但是单靠这个指标并不能反映系统实际承载的压力，我们还要结合用户行为模型才能得到系统实际承载的压力。</li>
<li><strong>后端服务器层面的并发用户数</strong>，指的是“同时向服务器发送请求的数量”，直接反映了系统实际承载的压力。</li>
</ul>
<p><em>场景举例：<br>一个已经投入运行的 ERP 系统，该系统所在企业共有 5000 名员工并都拥有账号，也就是说这个系统有 5000 个潜在用户。根据系统日志分析得知，该系统最大在线用户数是 2500 人。</em></p>
<p><strong>业务层面的并发用户数</strong>=2500人 （此数值仅仅表明在最高峰时段有 2500 个用户登录了系统，而服务器所承受的实际压力取决于登录用户行为，所以它不能准确反映服务器此时此刻实际承载的压力）</p>
<p><em>用户行为分析建模：<br>假设在某一时间点上，这 2500 个用户中，30% 用户处于页面浏览状态（对服务器没有发起请求），20% 用户在填写订单（也没有对服务器发起请求），5% 用户在递交订单，15% 用户在查询订单，而另外的 30% 用户没有进行任何操作。</em></p>
<p><strong>后端服务器层面的并发用户数</strong>=500人（这 2500 个“并发用户”中真正对服务器产生压力的只有 500 个用户（（5%+15%）*2500=500））。</p>
<p>从这个例子可以看出，后端服务器层面的并发用户数，同时取决于业务层面并发用户数和用户行为模式，而且用户行为模式占的比重较大。因此，分析得到准确的用户行为模式，是性能测试中的关键一环。获得精准的用户行为模式，是除了获取性能需求外，最困难的工作。</p>
<h2 id="响应时间-RT"><a href="#响应时间-RT" class="headerlink" title="响应时间 RT"></a>响应时间 RT</h2><p>RT：处理一次请求所需要的平均处理时间<br>响应时间是终端用户对系统性能的最直观印象，包括系统响应时间和前端展现时间</p>
<ul>
<li>系统响应时间又可以进一步细分为后台系统处理时间、数据库处理时间和网络传输时间等；</li>
<li>前端展现时间，取决于客户端收到服务器返回的数据后渲染页面所消耗的时间</li>
</ul>
<h2 id="系统吞吐率-TPS"><a href="#系统吞吐率-TPS" class="headerlink" title="系统吞吐率 TPS"></a>系统吞吐率 TPS</h2><p>TPS：每秒钟处理完的事务次数，即吞吐率；一般TPS是对整个系统来讲的。一个应用系统1s能完成多少事务处理，一个事务在分布式处理中，可能会对应多个请求，对于衡量单个接口服务的处理能力，用QPS比较多</p>
<h2 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h2><p>QPS: 服务器一秒钟处理完请求的数量；注意这里是处理完。具体是指发出请求到服务器处理完成功返回结果。可以理解在server中有个counter，每处理一个请求加1，1秒后 counter=QPS<br>计算公式：QPS = 并发用户数 / 平均响应时间</p>
<p><em>举个列子：<br>如果一次性可以处理100个请求并发量，每个请求耗时100毫秒，则qps = 1000<br>如果一次性可以处理50个请求并发量，每个请求耗时200毫秒，则qps = 250<br>所以QPS与单个请求处理时间以及服务器一次性可以处理多少请求是成比例关系的</em></p>
<p>部分内容参考极客时间: <a href="https://time.geekbang.org/column/article/14577#previewimg" target="_blank" rel="noopener">https://time.geekbang.org/column/article/14577#previewimg</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">liaoxb</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liaoxb</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
